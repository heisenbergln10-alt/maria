<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maria — Celestial Symphony</title>
    <meta name="description" content="An immersive digital experience crafted for Maria">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>⭐</text></svg>">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,opsz,wght@0,6..96,200..900;1,6..96,200..900&family=Crimson+Pro:ital,wght@0,200..900;1,200..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Amiri:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --base-light: #faf8f6;
            --base-dark: #f5f1ed;
            --text-primary: #0a0a0a;
            --text-secondary: rgba(10, 10, 10, 0.7);
            --accent-gold: #c9a961;
            --accent-gold-dark: #a88545;
            --gray-muted: #e3ddd7;
            --charcoal: #2a2928;
            
            --font-display: 'Bodoni Moda', serif;
            --font-body: 'Crimson Pro', serif;
            --font-mono: 'JetBrains Mono', monospace;
            
            --fs-hero: clamp(3rem, 8vw, 6rem);
            --fs-title: clamp(2rem, 5vw, 3.5rem);
            --fs-heading: clamp(1.5rem, 3vw, 2.5rem);
            --fs-body: clamp(1rem, 2vw, 1.25rem);
            --fs-small: clamp(0.875rem, 1.5vw, 1rem);
            
            --space-xs: clamp(0.5rem, 1vw, 1rem);
            --space-sm: clamp(1rem, 2vw, 1.5rem);
            --space-md: clamp(2rem, 4vw, 3rem);
            --space-lg: clamp(3rem, 6vw, 5rem);
            --space-xl: clamp(4rem, 8vw, 8rem);
            
            --blur-subtle: 10px;
            --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.1);
            --shadow-glow: 0 0 30px rgba(201, 169, 97, 0.3);
            
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-spring: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --base-light: #1a1918;
                --base-dark: #0f0e0e;
                --text-primary: #faf8f6;
                --text-secondary: rgba(250, 248, 246, 0.7);
                --gray-muted: #3a3836;
            }
        }

        html {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        body {
            font-family: var(--font-body);
            font-weight: 400;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(180deg, var(--base-light) 0%, var(--base-dark) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-muted);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-gold);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-gold-dark);
        }

        ::selection {
            background: var(--accent-gold);
            color: var(--base-light);
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-display);
            font-weight: 300;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }

        h1 { font-size: var(--fs-hero); }
        h2 { font-size: var(--fs-title); }
        h3 { font-size: var(--fs-heading); }

        p {
            font-size: var(--fs-body);
            margin-bottom: var(--space-sm);
        }

        .mono {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            letter-spacing: 0.05em;
        }

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-md) 0;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(var(--blur-subtle));
            -webkit-backdrop-filter: blur(var(--blur-subtle));
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-soft);
        }

        .hidden {
            display: none;
        }

        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.03;
            z-index: 1000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='1'/%3E%3C/svg%3E");
        }

        .cursor {
            width: 20px;
            height: 20px;
            border: 2px solid var(--accent-gold);
            border-radius: 50%;
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.15s ease-out;
            mix-blend-mode: difference;
        }

        .cursor-dot {
            width: 4px;
            height: 4px;
            background: var(--accent-gold);
            border-radius: 50%;
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            mix-blend-mode: difference;
        }

        header {
            height: 100vh;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #cosmic-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            padding: var(--space-md);
        }

        .hero-title {
            font-weight: 200;
            margin-bottom: var(--space-md);
            opacity: 0;
            animation: fadeInUp 1.5s ease-out forwards;
        }

        .hero-quote {
            font-size: var(--fs-heading);
            font-style: italic;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
            opacity: 0;
            animation: fadeInUp 1.5s ease-out 0.5s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
            from {
                opacity: 0;
                transform: translateY(30px);
            }
        }

        nav {
            position: fixed;
            top: 50%;
            right: 2rem;
            transform: translateY(-50%);
            z-index: 100;
        }

        .nav-orbs {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            position: relative;
        }

        .nav-orb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-gold);
            cursor: pointer;
            position: relative;
            transition: var(--transition-spring);
        }

        .nav-orb::before {
            content: attr(data-label);
            position: absolute;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--charcoal);
            color: var(--base-light);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition-smooth);
        }

        .nav-orb:hover {
            transform: scale(2);
            box-shadow: var(--shadow-glow);
        }

        .nav-orb:hover::before {
            opacity: 1;
            right: 2.5rem;
        }

        .nav-lines {
            position: absolute;
            top: 0;
            left: 50%;
            width: 1px;
            height: 100%;
            background: linear-gradient(to bottom, transparent, var(--accent-gold), transparent);
            opacity: 0.3;
            transform: translateX(-50%);
        }

        section {
            min-height: 100vh;
            padding: var(--space-xl) 0;
            position: relative;
            border-bottom: 1px solid rgba(201, 169, 97, 0.1);
        }

        section:last-of-type {
            border-bottom: none;
        }

        .section-title {
            text-align: center;
            margin-bottom: var(--space-lg);
            font-weight: 300;
        }

        /* Quantum Entanglement Web */
        #connections {
            background: radial-gradient(ellipse at center, rgba(10, 10, 30, 0.3) 0%, rgba(0, 0, 0, 0.5) 70%);
            position: relative;
        }

        .thought-web {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            min-height: 600px;
        }

        .concept-node {
            position: absolute;
            width: 120px;
            height: 120px;
            background: rgba(201, 169, 97, 0.1);
            border: 2px solid var(--accent-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-family: var(--font-mono);
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition-smooth);
            z-index: 10;
        }

        .concept-node:hover {
            background: rgba(201, 169, 97, 0.3);
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(201, 169, 97, 0.5);
        }

        .concept-node.active {
            background: rgba(201, 169, 97, 0.4);
            box-shadow: 0 0 40px rgba(201, 169, 97, 0.7);
        }

        .connection-line {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
            transform-origin: left center;
            z-index: 1;
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        .connection-line.active {
            opacity: 0.8;
            height: 2px;
            box-shadow: 0 0 10px var(--accent-gold);
        }

        .thought-display {
            margin-top: var(--space-lg);
            padding: var(--space-lg);
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            min-height: 200px;
        }

        .thought-content {
            font-size: var(--fs-body);
            line-height: 1.8;
            text-align: center;
            color: var(--text-primary);
            max-width: 800px;
            margin: 0 auto;
        }

        #chamber {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.05) 0%, transparent 50%);
        }

        .essay-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-md);
            perspective: 1000px;
        }

        .essay-card {
            background: var(--base-light);
            border-radius: 15px;
            padding: var(--space-md);
            cursor: pointer;
            transform-style: preserve-3d;
            transition: var(--transition-spring);
            position: relative;
            overflow: hidden;
        }

        .essay-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(201, 169, 97, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .essay-card:hover::before {
            transform: translateX(100%);
        }

        .essay-card:hover {
            transform: rotateY(5deg) rotateX(-5deg) translateZ(20px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .essay-title {
            font-size: var(--fs-heading);
            margin-bottom: var(--space-sm);
            color: var(--accent-gold-dark);
        }

        .essay-excerpt {
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .essay-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition-smooth);
        }

        .essay-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .essay-content {
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            padding: var(--space-lg);
            background: var(--base-light);
            border-radius: 20px;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            border: none;
            background: var(--accent-gold);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--base-light);
            transition: var(--transition-smooth);
        }

        .close-modal:hover {
            transform: rotate(90deg);
            background: var(--accent-gold-dark);
        }

        /* Music Player Styles */
        .music-interface {
            max-width: 900px;
            margin: 0 auto;
        }

        .music-player {
            padding: var(--space-lg);
            border-radius: 30px;
            background: linear-gradient(135deg, rgba(42, 41, 40, 0.2) 0%, rgba(201, 169, 97, 0.1) 100%);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .spotify-main-player {
            margin-bottom: var(--space-md);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            min-height: 352px;
        }

        #embed-iframe {
            width: 100%;
            height: 352px;
            border-radius: 12px;
        }

        .playlist-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: var(--space-md);
            max-height: 400px;
            overflow-y: auto;
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid rgba(201, 169, 97, 0.2);
        }

        .playlist-header h4 {
            font-family: var(--font-display);
            font-size: var(--fs-body);
            font-weight: 300;
            margin: 0;
        }

        .track-count {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            color: var(--text-secondary);
        }

        .playlist-items {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .playlist-item {
            display: grid;
            grid-template-columns: 30px 1fr auto;
            gap: var(--space-sm);
            padding: var(--space-sm);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .playlist-item:hover {
            background: rgba(201, 169, 97, 0.1);
            transform: translateX(5px);
        }

        .playlist-item.active {
            background: rgba(201, 169, 97, 0.2);
            border-left: 3px solid var(--accent-gold);
        }

        .playlist-number {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            color: var(--text-secondary);
            text-align: center;
        }

        .playlist-track-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            min-width: 0;
        }

        .playlist-track-title {
            font-size: var(--fs-small);
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .playlist-track-artist {
            font-size: 0.875rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .playlist-track-duration {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            color: var(--text-secondary);
        }

        /* Enhanced Paradox Engine */
        #paradox {
            background: linear-gradient(135deg, rgba(42, 41, 40, 0.1) 0%, transparent 50%, rgba(42, 41, 40, 0.1) 100%);
        }

        .paradox-interface {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--space-lg);
            border-radius: 20px;
        }

        .complexity-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
            margin: var(--space-md) 0;
        }

        .slider-control {
            padding: var(--space-sm);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }

        .slider-label {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            color: var(--accent-gold);
            margin-bottom: var(--space-xs);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .slider-input {
            width: 100%;
            height: 6px;
            background: rgba(201, 169, 97, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--accent-gold);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(201, 169, 97, 0.5);
        }

        .slider-input::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: var(--accent-gold);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(201, 169, 97, 0.5);
        }

        .paradox-controls {
            display: grid;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .paradox-mode-selector {
            display: flex;
            justify-content: center;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: 1px solid rgba(201, 169, 97, 0.5);
            color: var(--text-secondary);
            border-radius: 25px;
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .mode-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
            background: rgba(201, 169, 97, 0.1);
        }

        .mode-btn.active {
            background: var(--accent-gold);
            color: var(--base-light);
            border-color: var(--accent-gold);
        }

        .paradox-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            margin: 0 auto;
            padding: 1rem 3rem;
            background: transparent;
            border: 2px solid var(--accent-gold);
            color: var(--accent-gold);
            font-family: var(--font-display);
            font-size: var(--fs-body);
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .paradox-button:hover {
            background: var(--accent-gold);
            color: var(--base-light);
            transform: scale(1.05);
        }

        .paradox-output {
            margin-top: var(--space-lg);
            padding: var(--space-lg);
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(201, 169, 97, 0.3);
            border-radius: 20px;
        }

        .paradox-title {
            font-family: var(--font-display);
            font-size: var(--fs-heading);
            color: var(--accent-gold);
            text-align: center;
            margin-bottom: var(--space-md);
        }

        .paradox-content {
            font-size: var(--fs-body);
            line-height: 1.8;
            margin-bottom: var(--space-md);
        }

        /* Arabic Verse Generator */
        #poems {
            background: linear-gradient(to bottom, 
                rgba(20, 20, 40, 0.3) 0%, 
                rgba(40, 20, 60, 0.2) 50%,
                rgba(0, 0, 0, 0.4) 100%);
            position: relative;
            overflow: hidden;
        }

        .poem-interface {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .poem-display {
            padding: var(--space-lg);
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            margin-bottom: var(--space-md);
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .poem-text {
            font-size: 1.75rem;
            line-height: 2.5;
            color: var(--text-primary);
            max-width: 700px;
            text-align: center;
            white-space: pre-line;
            font-family: 'Amiri', serif;
            direction: rtl;
        }

        .generate-poem-btn {
            padding: 1rem 2.5rem;
            background: linear-gradient(135deg, 
                rgba(201, 169, 97, 0.2) 0%, 
                rgba(201, 169, 97, 0.1) 100%);
            border: 2px solid var(--accent-gold);
            color: var(--accent-gold);
            font-family: var(--font-display);
            font-size: var(--fs-body);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .generate-poem-btn:hover {
            background: var(--accent-gold);
            color: var(--base-light);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(201, 169, 97, 0.3);
        }

        /* Midnight Radio with Old Design */
        #facts {
            background: linear-gradient(to bottom, 
                rgba(0, 0, 0, 0.8) 0%, 
                rgba(10, 0, 20, 0.6) 50%, 
                rgba(0, 0, 0, 0.9) 100%);
            position: relative;
            overflow: hidden;
        }

        .radio-interface {
            max-width: 1000px;
            margin: 0 auto;
        }

        .radio-device {
            padding: var(--space-lg);
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 100%);
            border-radius: 20px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.05),
                inset 0 -1px 0 rgba(0, 0, 0, 0.8);
            position: relative;
            margin-bottom: var(--space-md);
            overflow: hidden;
        }

        .radio-display {
            background: #000;
            padding: var(--space-md);
            border-radius: 15px;
            margin-bottom: var(--space-md);
            box-shadow: inset 0 5px 15px rgba(0, 0, 0, 0.8);
            position: relative;
            overflow: hidden;
        }

        .frequency-band {
            position: relative;
            height: 40px;
            background: linear-gradient(90deg, 
                #1a2a1a 0%, 
                #2a3a2a 25%, 
                #3a4a3a 50%, 
                #2a3a2a 75%, 
                #1a2a1a 100%);
            border-radius: 5px;
            margin-bottom: var(--space-sm);
            overflow: hidden;
        }

        .frequency-marker {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 100%;
            background: var(--accent-gold);
            box-shadow: 0 0 20px var(--accent-gold);
            transition: left 0.3s ease;
        }

        .frequency-numbers {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            color: #2a4a2a;
            font-family: var(--font-mono);
            font-size: 0.75rem;
        }

        .station-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) 0;
        }

        .station-name {
            font-family: var(--font-mono);
            font-size: var(--fs-heading);
            color: var(--accent-gold);
            text-shadow: 
                0 0 20px rgba(201, 169, 97, 0.5),
                0 0 40px rgba(201, 169, 97, 0.3);
            letter-spacing: 0.2em;
        }

        .frequency-display {
            font-family: var(--font-mono);
            font-size: var(--fs-body);
            color: #2a4a2a;
        }

        .radio-visualizer {
            position: relative;
            height: 150px;
            background: #000;
            border-radius: 10px;
            margin-bottom: var(--space-md);
            overflow: hidden;
            box-shadow: inset 0 5px 15px rgba(0, 0, 0, 0.8);
        }

        .radio-controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: var(--space-md);
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border-radius: 15px;
            margin-bottom: var(--space-md);
        }

        .radio-btn {
            padding: 1rem 2rem;
            background: #0a0a0a;
            border: 2px solid #2a2a2a;
            color: #6a6a6a;
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
        }

        .radio-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
            box-shadow: 0 0 20px rgba(201, 169, 97, 0.3);
        }

        .power-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .power-led {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #330000;
            box-shadow: 0 0 10px #330000;
            transition: var(--transition-smooth);
        }

        .power-btn.active .power-led {
            background: var(--accent-gold);
            box-shadow: 0 0 30px var(--accent-gold);
            animation: led-pulse 2s ease-in-out infinite;
        }

        @keyframes led-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .tuner-knob {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at 30% 30%, #3a3a3a 0%, #0a0a0a 100%);
            border-radius: 50%;
            position: relative;
            cursor: grab;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.8),
                inset 0 -2px 5px rgba(0, 0, 0, 0.8);
        }

        .tuner-knob:active {
            cursor: grabbing;
        }

        .knob-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 20px;
            background: var(--accent-gold);
            border-radius: 2px;
            box-shadow: 0 0 10px var(--accent-gold);
        }

        .transcript-display {
            padding: var(--space-lg);
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            margin-bottom: var(--space-md);
            min-height: 200px;
            border: 1px solid rgba(201, 169, 97, 0.1);
        }

        .transcript-text {
            font-size: var(--fs-body);
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
            text-shadow: 0 0 5px rgba(201, 169, 97, 0.1);
        }

        footer {
            min-height: 30vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--charcoal);
            color: var(--base-light);
            overflow: hidden;
        }

        .footer-content {
            text-align: center;
        }

        .footer-content p {
            color: var(--accent-gold);
        }

        .particle {
            position: fixed;
            pointer-events: none;
            opacity: 0.5;
            animation: floatParticle 20s infinite;
        }

        @keyframes floatParticle {
            0%, 100% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.5;
            }
            90% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-100vh) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        .loading {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(201, 169, 97, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-gold);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            nav {
                display: none;
            }

            .essay-container {
                grid-template-columns: 1fr;
            }

            #embed-iframe {
                height: 250px !important;
            }

            .complexity-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="grain" aria-hidden="true"></div>
    <div class="cursor" aria-hidden="true"></div>
    <div class="cursor-dot" aria-hidden="true"></div>

    <header>
        <canvas id="cosmic-canvas"></canvas>
        <div class="hero-content">
            <h1 class="hero-title">Maria</h1>
            <p class="hero-quote">"We are made of star stuff, contemplating the stars"</p>
        </div>
    </header>

    <nav>
        <div class="nav-orbs">
            <div class="nav-lines"></div>
            <a href="#connections" class="nav-orb" data-label="Quantum"></a>
            <a href="#chamber" class="nav-orb" data-label="Chamber"></a>
            <a href="#music" class="nav-orb" data-label="Music"></a>
            <a href="#paradox" class="nav-orb" data-label="Paradox"></a>
            <a href="#poems" class="nav-orb" data-label="Poetry"></a>
            <a href="#facts" class="nav-orb" data-label="Radio"></a>
        </div>
    </nav>

    <main>
        <!-- Quantum Entanglement Web -->
        <section id="connections" class="fade-in">
            <div class="container">
                <h2 class="section-title">Quantum Entanglement</h2>
                <p class="mono" style="text-align: center; margin-bottom: var(--space-md);">Explore the hidden connections between realities</p>
                
                <div class="thought-web" id="thought-web">
                    <!-- Concept nodes will be generated here -->
                </div>
                
                <div class="thought-display glass">
                    <div class="thought-content" id="thought-content">
                        Click on quantum states to collapse their wave functions...
                    </div>
                </div>
            </div>
        </section>

        <section id="chamber" class="fade-in">
            <div class="container">
                <h2 class="section-title">Chamber of Echoes</h2>
                <div class="essay-container">
                    <article class="essay-card glass">
                        <h3 class="essay-title">On Consciousness</h3>
                        <p class="essay-excerpt">The mirror of awareness reflects not just the world, but the very act of reflection itself...</p>
                    </article>
                    <article class="essay-card glass">
                        <h3 class="essay-title">The Nature of Time</h3>
                        <p class="essay-excerpt">Time flows not as a river, but as an ocean—vast, deep, and full of currents we barely perceive...</p>
                    </article>
                    <article class="essay-card glass">
                        <h3 class="essay-title">Beauty's Whisper</h3>
                        <p class="essay-excerpt">In the fleeting moment of aesthetic arrest, we touch something eternal, something that was always there...</p>
                    </article>
                    <article class="essay-card glass">
                        <h3 class="essay-title">The Gift of Suffering</h3>
                        <p class="essay-excerpt">Pain carves the vessel in which joy is held. Without darkness, light has no meaning...</p>
                    </article>
                    <article class="essay-card glass">
                        <h3 class="essay-title">Love as Verb</h3>
                        <p class="essay-excerpt">Love is not found but forged, not felt but enacted, a daily choice to see the sacred in another...</p>
                    </article>
                    <article class="essay-card glass">
                        <h3 class="essay-title">Dancing with Death</h3>
                        <p class="essay-excerpt">Mortality is the dark backdrop against which life's colors shine most brilliantly...</p>
                    </article>
                </div>
            </div>
        </section>

        <div class="essay-modal">
            <div class="essay-content glass">
                <button class="close-modal">&times;</button>
                <h3 id="modal-title" class="essay-title"></h3>
                <div class="modal-body"></div>
            </div>
        </div>

        <section id="music" class="fade-in">
            <div class="container">
                <h2 class="section-title">Musical Journey</h2>
                <p class="mono" style="text-align: center; margin-bottom: var(--space-md);">Egyptian classics & timeless melodies</p>
                
                <div class="music-interface">
                    <div class="music-player glass">
                        <div class="spotify-main-player">
                            <div id="embed-iframe"></div>
                        </div>
                        
                        <div class="playlist-section" style="margin-top: var(--space-md);">
                            <div class="playlist-header">
                                <h4>Egyptian Classics Collection</h4>
                                <span class="track-count">10 masterpieces</span>
                            </div>
                            <div class="playlist-items" id="playlist-items">
                                <div class="playlist-item active" 
                                     data-id="3gFcGnU4kTdMYLXDjH1TK8"
                                     data-title="Enta Omri"
                                     data-artist="Umm Kulthum">
                                    <div class="playlist-number">1</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Enta Omri</div>
                                        <div class="playlist-track-artist">Umm Kulthum</div>
                                    </div>
                                    <div class="playlist-track-duration">38:31</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="7ouRfMhJnMA3a88VBzByxW"
                                     data-title="Alf Leila wa Leila"
                                     data-artist="Umm Kulthum">
                                    <div class="playlist-number">2</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Alf Leila wa Leila</div>
                                        <div class="playlist-track-artist">Umm Kulthum</div>
                                    </div>
                                    <div class="playlist-track-duration">54:01</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="73bzFhkyCVb4rf65BzwMmt"
                                     data-title="Ahwak"
                                     data-artist="Abdel Halim Hafez">
                                    <div class="playlist-number">3</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Ahwak</div>
                                        <div class="playlist-track-artist">Abdel Halim Hafez</div>
                                    </div>
                                    <div class="playlist-track-duration">4:12</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="6dwvEqcqiMlOUqEgtZq5oR"
                                     data-title="Gana El Hawa"
                                     data-artist="Abdel Halim Hafez">
                                    <div class="playlist-number">4</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Gana El Hawa</div>
                                        <div class="playlist-track-artist">Abdel Halim Hafez</div>
                                    </div>
                                    <div class="playlist-track-duration">6:18</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="0MnG7RgYTmYhPGDbFQasz0"
                                     data-title="Nassam Alayna El Hawa"
                                     data-artist="Fairuz">
                                    <div class="playlist-number">5</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Nassam Alayna El Hawa</div>
                                        <div class="playlist-track-artist">Fairuz</div>
                                    </div>
                                    <div class="playlist-track-duration">3:47</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="7mJszBFgMOIoD72QmVgpxC"
                                     data-title="Ya Msafer"
                                     data-artist="Mohamed Abdel Wahab">
                                    <div class="playlist-number">6</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Ya Msafer</div>
                                        <div class="playlist-track-artist">Mohamed Abdel Wahab</div>
                                    </div>
                                    <div class="playlist-track-duration">5:03</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="6kBG7OOWkbNm0nYQqdHOqL"
                                     data-title="Batwanes Beek"
                                     data-artist="Warda">
                                    <div class="playlist-number">7</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Batwanes Beek</div>
                                        <div class="playlist-track-artist">Warda</div>
                                    </div>
                                    <div class="playlist-track-duration">10:23</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="1yBvomPMq8SJzV6tBhZCCB"
                                     data-title="Ayoun El Alb"
                                     data-artist="Najat Al Saghira">
                                    <div class="playlist-number">8</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Ayoun El Alb</div>
                                        <div class="playlist-track-artist">Najat Al Saghira</div>
                                    </div>
                                    <div class="playlist-track-duration">5:58</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="67OWUJEyH08sNlEG7UQzjz"
                                     data-title="Ya Zahratan Fi Khayali"
                                     data-artist="Farid Al Atrash">
                                    <div class="playlist-number">9</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Ya Zahratan Fi Khayali</div>
                                        <div class="playlist-track-artist">Farid Al Atrash</div>
                                    </div>
                                    <div class="playlist-track-duration">4:37</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="4vCkQHhNGuyiCMWxNBQ0cP"
                                     data-title="Ya Habibi Taala"
                                     data-artist="Asmahan">
                                    <div class="playlist-number">10</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Ya Habibi Taala</div>
                                        <div class="playlist-track-artist">Asmahan</div>
                                    </div>
                                    <div class="playlist-track-duration">3:12</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="paradox" class="fade-in">
            <div class="container">
                <h2 class="section-title">The Paradox Engine</h2>
                <p class="mono" style="text-align: center; margin-bottom: var(--space-md);">Generate philosophical thought experiments</p>
                
                <div class="paradox-interface glass">
                    <div class="paradox-controls">
                        <div class="paradox-mode-selector">
                            <button class="mode-btn active" data-mode="paradox">Paradox</button>
                            <button class="mode-btn" data-mode="dilemma">Ethical Dilemma</button>
                            <button class="mode-btn" data-mode="thought">Thought Experiment</button>
                            <button class="mode-btn" data-mode="dialogue">Socratic Dialogue</button>
                        </div>
                        
                        <div class="complexity-controls">
                            <div class="slider-control">
                                <div class="slider-label">
                                    <span>Complexity</span>
                                    <span id="complexity-value">3</span>
                                </div>
                                <input type="range" class="slider-input" id="complexity-slider" min="1" max="5" value="3">
                            </div>
                            <div class="slider-control">
                                <div class="slider-label">
                                    <span>Abstraction</span>
                                    <span id="abstraction-value">3</span>
                                </div>
                                <input type="range" class="slider-input" id="abstraction-slider" min="1" max="5" value="3">
                            </div>
                        </div>
                    </div>
                    
                    <button id="generate-paradox" class="paradox-button">
                        <span>Generate</span>
                    </button>
                    
                    <div id="paradox-output" class="paradox-output hidden">
                        <div class="paradox-title"></div>
                        <div class="paradox-content"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="poems" class="fade-in">
            <div class="container">
                <h2 class="section-title">Arabic Poetry</h2>
                <p class="mono" style="text-align: center; margin-bottom: var(--space-md);">شعر من أعماق الروح</p>
                
                <div class="poem-interface">
                    <div class="poem-display glass">
                        <div class="poem-text" id="poem-text">
                            اضغط لتوليد قصيدة...
                        </div>
                    </div>
                    
                    <button class="generate-poem-btn" id="generate-poem">
                        Generate Arabic Verse
                    </button>
                </div>
            </div>
        </section>

        <section id="facts" class="fade-in">
            <div class="container">
                <h2 class="section-title">Midnight Radio</h2>
                <p class="mono" style="text-align: center; margin-bottom: var(--space-md);">Dark frequencies from the void</p>
                
                <div class="radio-interface">
                    <div class="radio-device glass">
                        <div class="radio-display">
                            <div class="frequency-band">
                                <div class="frequency-marker" id="frequency-marker"></div>
                                <div class="frequency-numbers">
                                    <span>88</span><span>92</span><span>96</span><span>100</span><span>104</span><span>108</span>
                                </div>
                            </div>
                            <div class="station-display">
                                <div class="station-name" id="station-name">VOID.FM</div>
                                <div class="frequency-display" id="frequency-display">88.5</div>
                            </div>
                        </div>
                        
                        <div class="radio-visualizer">
                            <canvas id="audio-visualizer"></canvas>
                        </div>
                        
                        <div class="radio-controls">
                            <button class="radio-btn power-btn" id="power-btn">
                                <div class="power-led"></div>
                            </button>
                            
                            <div class="tuner-knob" id="tuner-knob">
                                <div class="knob-indicator"></div>
                            </div>
                            
                            <button class="radio-btn scan-btn" id="scan-btn">SCAN</button>
                        </div>
                    </div>
                    
                    <div class="transcript-display glass">
                        <div class="transcript-content">
                            <p class="transcript-text" id="transcript-text">
                                *static* ...tuning into the frequencies between nightmares and reality...
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p class="mono">Created with love for Maria</p>
        </div>
    </footer>

    <script src="https://open.spotify.com/embed/iframe-api/v1" async></script>

    <script>
        const state = {
            mouseX: 0,
            mouseY: 0,
            currentTrack: 0,
            isPlaying: false,
            isPowered: false,
            currentFrequency: 88.5,
            complexity: 3,
            abstraction: 3,
            currentStation: null
        };

        document.addEventListener('DOMContentLoaded', () => {
            initCustomCursor();
            initCosmicCanvas();
            initIntersectionObserver();
            initQuantumWeb();
            initEssayCards();
            initEnhancedParadox();
            initArabicPoetry();
            initDarkRadio();
            initFloatingParticles();
        });

        // Spotify Player
        let player;
        let currentURI = null;
        
        window.onSpotifyIframeApiReady = (IFrameAPI) => {
            const element = document.getElementById('embed-iframe');
            currentURI = 'spotify:track:3gFcGnU4kTdMYLXDjH1TK8';
            
            IFrameAPI.createController(element, { 
                uri: currentURI,
                width: '100%',
                height: '352'
            }, (ctrl) => {
                player = ctrl;
                
                document.querySelectorAll('.playlist-item').forEach((item) => {
                    item.addEventListener('click', () => {
                        const uri = 'spotify:track:' + item.dataset.id;
                        if (uri === currentURI && state.isPlaying) return;
                        
                        currentURI = uri;
                        
                        document.querySelectorAll('.playlist-item').forEach(i => {
                            i.classList.remove('active');
                        });
                        item.classList.add('active');
                        
                        player.loadUri(uri);
                        player.play();
                        
                        state.isPlaying = true;
                        state.currentTrack = Array.from(document.querySelectorAll('.playlist-item')).indexOf(item);
                    });
                });
            });
        };

        function initCustomCursor() {
            const cursor = document.querySelector('.cursor');
            const cursorDot = document.querySelector('.cursor-dot');
            
            document.addEventListener('mousemove', (e) => {
                state.mouseX = e.clientX;
                state.mouseY = e.clientY;
                cursor.style.left = e.clientX - 10 + 'px';
                cursor.style.top = e.clientY - 10 + 'px';
                cursorDot.style.left = e.clientX - 2 + 'px';
                cursorDot.style.top = e.clientY - 2 + 'px';
            });
        }

        function initCosmicCanvas() {
            const canvas = document.getElementById('cosmic-canvas');
            const ctx = canvas.getContext('2d');
            let bgStars = [];

            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                initBackgroundStars();
            }

            function initBackgroundStars() {
                bgStars = [];
                for (let i = 0; i < 200; i++) {
                    bgStars.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        radius: Math.random() * 2,
                        opacity: Math.random()
                    });
                }
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                bgStars.forEach(star => {
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(201, 169, 97, ${star.opacity})`;
                    ctx.fill();
                    
                    star.y += 0.5;
                    if (star.y > canvas.height) star.y = 0;
                });
                
                requestAnimationFrame(animate);
            }

            window.addEventListener('resize', resize);
            resize();
            animate();
        }

        function initIntersectionObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
        }

        // Quantum Entanglement Web
        function initQuantumWeb() {
            const web = document.getElementById('thought-web');
            const content = document.getElementById('thought-content');
            
            const concepts = [
                { name: 'Entropy', x: 20, y: 30, connections: ['Chaos', 'Information', 'Decay'] },
                { name: 'Chaos', x: 80, y: 20, connections: ['Entropy', 'Fractal', 'Emergence'] },
                { name: 'Information', x: 50, y: 60, connections: ['Entropy', 'Pattern', 'Observer'] },
                { name: 'Pattern', x: 30, y: 80, connections: ['Information', 'Fractal', 'Symmetry'] },
                { name: 'Fractal', x: 70, y: 70, connections: ['Chaos', 'Pattern', 'Recursion'] },
                { name: 'Emergence', x: 85, y: 50, connections: ['Chaos', 'Complexity', 'Observer'] },
                { name: 'Observer', x: 15, y: 55, connections: ['Information', 'Emergence', 'Collapse'] },
                { name: 'Collapse', x: 45, y: 25, connections: ['Observer', 'Symmetry', 'Decay'] },
                { name: 'Symmetry', x: 60, y: 85, connections: ['Pattern', 'Collapse', 'Recursion'] },
                { name: 'Recursion', x: 50, y: 40, connections: ['Fractal', 'Symmetry', 'Complexity'] },
                { name: 'Complexity', x: 35, y: 50, connections: ['Emergence', 'Recursion', 'Decay'] },
                { name: 'Decay', x: 65, y: 35, connections: ['Entropy', 'Collapse', 'Complexity'] }
            ];
            
            const thoughts = {
                'Entropy': "The universe tends toward maximum disorder, yet islands of complexity emerge. We are temporary violations of thermodynamic law, burning bright against the inevitable heat death.",
                'Chaos': "Deterministic systems produce unpredictable outcomes. A butterfly's wing beat cascades through dimensions of possibility. In chaos, we find the seeds of all creation and destruction.",
                'Information': "Reality might be computational—bits of quantum information processing themselves. Every observation adds data to the cosmic algorithm. We are both the code and the compiler.",
                'Pattern': "Patterns repeat across scales: galaxies spiral like shells, neurons branch like rivers. The universe speaks in recursive languages, whispering the same truths in different frequencies.",
                'Fractal': "Infinite complexity emerges from simple rules. Zoom in or out, the pattern persists. We are fractals of consciousness, self-similar across scales of existence.",
                'Emergence': "The whole becomes greater than its parts. Consciousness emerges from neurons, cities from individuals, galaxies from dust. Emergence is the universe's magic trick.",
                'Observer': "The act of observation collapses possibility into actuality. We are the universe observing itself, creating reality through the mere act of witnessing.",
                'Collapse': "Wave functions collapse into particles, possibilities into facts. Every choice is a quantum collapse, destroying infinite futures to create one present.",
                'Symmetry': "The universe loves symmetry but breaks it to exist. Perfect symmetry is sterile; broken symmetry creates diversity, complexity, life itself.",
                'Recursion': "Systems that reference themselves create strange loops. Consciousness thinking about consciousness. The paradox of self-awareness is reality's recursive function.",
                'Complexity': "Between order and chaos lies complexity—the edge where life thrives. Too much order stagnates; too much chaos destroys. We dance on the knife's edge.",
                'Decay': "All structures tend toward dissolution. Yet decay feeds new growth. Death is not an ending but a transformation of information, energy returning to the quantum foam."
            };
            
            // Create nodes
            concepts.forEach(concept => {
                const node = document.createElement('div');
                node.className = 'concept-node';
                node.textContent = concept.name;
                node.style.left = concept.x + '%';
                node.style.top = concept.y + '%';
                node.style.transform = 'translate(-50%, -50%)';
                
                node.addEventListener('click', () => {
                    document.querySelectorAll('.concept-node').forEach(n => n.classList.remove('active'));
                    document.querySelectorAll('.connection-line').forEach(l => l.classList.remove('active'));
                    
                    node.classList.add('active');
                    content.textContent = thoughts[concept.name];
                    
                    concept.connections.forEach(conn => {
                        const connNode = Array.from(document.querySelectorAll('.concept-node'))
                            .find(n => n.textContent === conn);
                        if (connNode) {
                            const line = document.querySelector(`.line-${concept.name}-${conn}, .line-${conn}-${concept.name}`);
                            if (line) line.classList.add('active');
                        }
                    });
                });
                
                web.appendChild(node);
            });
            
            // Create connection lines
            const drawnConnections = new Set();
            concepts.forEach(concept => {
                concept.connections.forEach(conn => {
                    const key = [concept.name, conn].sort().join('-');
                    if (!drawnConnections.has(key)) {
                        drawnConnections.add(key);
                        
                        const fromNode = concepts.find(c => c.name === concept.name);
                        const toNode = concepts.find(c => c.name === conn);
                        
                        if (fromNode && toNode) {
                            const line = document.createElement('div');
                            line.className = `connection-line line-${concept.name}-${conn}`;
                            
                            const dx = toNode.x - fromNode.x;
                            const dy = toNode.y - fromNode.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            const angle = Math.atan2(dy, dx);
                            
                            line.style.width = distance + '%';
                            line.style.left = fromNode.x + '%';
                            line.style.top = fromNode.y + '%';
                            line.style.transform = `rotate(${angle}rad)`;
                            
                            web.appendChild(line);
                        }
                    }
                });
            });
        }

        function initEssayCards() {
            const cards = document.querySelectorAll('.essay-card');
            const modal = document.querySelector('.essay-modal');
            const closeBtn = document.querySelector('.close-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.querySelector('.modal-body');

            const essays = {
                'On Consciousness': '<p>Consciousness is the greatest mystery of existence. It is the mirror that reflects not just the world, but the very act of reflection itself. When we become aware of our awareness, we enter an infinite regress—a hall of mirrors where each reflection contains another observer observing the observation.</p><p>What does it mean to be conscious? Is it merely the firing of neurons, or is there something irreducible about the subjective experience of being? The hard problem of consciousness remains: how does matter give rise to mind?</p>',
                'The Nature of Time': '<p>Time flows not as a river, but as an ocean—vast, deep, and full of currents we barely perceive. We experience it linearly, moment by moment, yet physics tells us all moments exist simultaneously in the block universe.</p><p>Perhaps our perception of time passing is the greatest illusion, a necessary fiction that allows consciousness to navigate an otherwise incomprehensible reality. The present moment is all we ever have, yet it is infinitely elusive.</p>',
                'Beauty\'s Whisper': '<p>In the fleeting moment of aesthetic arrest, we touch something eternal, something that was always there but hidden from ordinary sight. Beauty is not in the object nor in the eye of the beholder, but in the sacred space between.</p><p>When we encounter true beauty, time stops. The chattering mind falls silent. We are reminded of what we knew before we learned to speak, before we learned to think—that we are part of something infinitely precious.</p>',
                'The Gift of Suffering': '<p>Pain carves the vessel in which joy is held. Without darkness, light has no meaning. Without death, life loses its preciousness. This is the paradox at the heart of existence: our greatest gifts come wrapped in our greatest challenges.</p><p>Suffering breaks us open, shatters our illusions, forces us to confront what we would rather avoid. Yet in that breaking, we often find our deepest strength, our most authentic self, our capacity for compassion.</p>',
                'Love as Verb': '<p>Love is not found but forged, not felt but enacted, a daily choice to see the sacred in another. It is not the fairy tale ending but the beginning of the real work—the work of truly seeing and being seen.</p><p>To love is to accept the full catastrophe of another human being, to say yes not just to their light but to their shadow. It is to choose connection over correctness, presence over perfection.</p>',
                'Dancing with Death': '<p>Mortality is the dark backdrop against which life\'s colors shine most brilliantly. Death is not the opposite of life but its most intimate companion, walking beside us always, whispering: "Not yet, but someday. So live, truly live, while you can."</p><p>When we befriend our mortality, we discover an unexpected freedom. The trivial falls away. What matters becomes clear. We learn to hold life lightly, to love fiercely, to forgive quickly.</p>'
            };

            cards.forEach(card => {
                card.addEventListener('click', () => {
                    const title = card.querySelector('.essay-title').textContent;
                    modalTitle.textContent = title;
                    modalBody.innerHTML = essays[title] || '<p>Coming soon...</p>';
                    modal.classList.add('active');
                });
            });

            closeBtn.addEventListener('click', () => modal.classList.remove('active'));
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.remove('active');
            });
        }

        // Enhanced Paradox with Separate Complexity and Abstraction
        function initEnhancedParadox() {
            const generateBtn = document.getElementById('generate-paradox');
            const outputDiv = document.getElementById('paradox-output');
            const titleEl = outputDiv.querySelector('.paradox-title');
            const contentEl = outputDiv.querySelector('.paradox-content');
        
            const complexitySlider = document.getElementById('complexity-slider');
            const abstractionSlider = document.getElementById('abstraction-slider');
            const complexityValue = document.getElementById('complexity-value');
            const abstractionValue = document.getElementById('abstraction-value');
        
            let currentMode = 'paradox';
        
            // 1) Put your Gemini API key here
            const GEMINI_API_KEY = "AIzaSyAqXYggfgLt5_dL6wLEkNZUnGXr5QHBch4";
        
            // 2) Map sliders to sampler config
            function mapComplexityToConfig(c, a) {
                const temperature = Math.min(1, 0.2 + (c + a) * 0.08);
                const maxOutputTokens = 400 + (c * 120);
                const topP = Math.min(0.98, 0.9 + (a * 0.02));
                return { temperature, topP, maxOutputTokens };
            }
        
            // 3) Precise JSON-only prompt
            function buildPrompt(mode, c, a) {
                return `
        You are ParadoxEngine, a concise, elegant philosophical content generator for a website.
        Produce a single piece according to the selected MODE, COMPLEXITY, and ABSTRACTION.
        
        MODE (exactly one of):
        - "paradox": present a classic or original paradox with 2–3 crisp tensions.
        - "dilemma": an ethical scenario with competing values and no trivial resolution.
        - "thought": a thought experiment that alters one premise of reality.
        - "dialogue": a short Socratic dialogue (8–12 lines, alternating "A:" / "B:").
        
        COMPLEXITY (1–5):
        - 1 = simple, intuitive; 5 = layered, multi-perspective, with a counterpoint.
        
        ABSTRACTION (1–5):
        - 1 = concrete examples; 5 = highly abstract and conceptual.
        
        STYLE:
        - 1–2 sentence title (striking, no clickbait).
        - Body: ~150–230 words (for "dialogue", 8–12 terse exchanges).
        - Tone: lucid, precise, graceful; no clichés; no fluff.
        - Avoid moralizing; present tensions clearly.
        - No external references or markdown.
        
        THOUGHT QUESTIONS:
        Return 3–5 short, open-ended questions that provoke reflection.
        
        OUTPUT FORMAT (IMPORTANT):
        Return ONLY valid JSON (no extra text, no markdown fences). Use this schema:
        {
          "title": "string",
          "body": "string",
          "questions": ["string", "string", ...]
        }
        
        INPUT:
        MODE="${mode}"
        COMPLEXITY=${c}
        ABSTRACTION=${a}
        `;
            }
        
            // 4) JSON extractor (in case the model adds stray text)
            function extractJson(text) {
                  // 1) direct
                  try { return JSON.parse(text); } catch {}
                  // 2) ```json ... ``` or ```
                  const fence = text.match(/```(?:json)?\s*([\s\S]*?)\s*```/i);
                  if (fence) { try { return JSON.parse(fence[1]); } catch {} }
                  // 3) largest {...}
                  const a = text.indexOf("{"), b = text.lastIndexOf("}");
                  if (a !== -1 && b !== -1 && b > a) {
                    try { return JSON.parse(text.slice(a, b + 1)); } catch {}
                  }
                  return null;
                }
                
                async function generateWithGemini(mode, c, a) {
                  const { temperature, topP, maxOutputTokens } = mapComplexityToConfig(c, a);
                
                  // Use v1 + stable model name
                  const endpoint =
                    "https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=" +
                    encodeURIComponent(GEMINI_API_KEY);
                
                  const prompt = buildPrompt(mode, c, a);
                
                  const body = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: { temperature, topP, maxOutputTokens },
                    // Make safety a bit less trigger-happy for philosophical content
                    safetySettings: [
                      { category: "HARM_CATEGORY_HARASSMENT",        threshold: "BLOCK_ONLY_HIGH" },
                      { category: "HARM_CATEGORY_HATE_SPEECH",       threshold: "BLOCK_ONLY_HIGH" },
                      { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_ONLY_HIGH" },
                      { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_ONLY_HIGH" }
                    ]
                  };
                
                  let res;
                  try {
                    res = await fetch(endpoint, {
                      method: "POST",
                      headers: { "Content-Type": "application/json" },
                      body: JSON.stringify(body)
                    });
                  } catch (e) {
                    console.error("[Gemini] Network error:", e);
                    throw e;
                  }
                
                  if (!res.ok) {
                    let errBody;
                    try { errBody = await res.json(); } catch {}
                    console.error("[Gemini] HTTP", res.status, errBody || await res.text());
                    throw new Error("Gemini HTTP " + res.status);
                  }
                
                  const data = await res.json();
                  const cand = data?.candidates?.[0];
                  if (!cand) {
                    console.error("[Gemini] No candidates:", data);
                    throw new Error("No candidates");
                  }
                  if (cand.finishReason && cand.finishReason !== "STOP") {
                    console.warn("[Gemini] Finish reason:", cand.finishReason, data?.promptFeedback);
                    throw new Error("FinishReason=" + cand.finishReason);
                  }
                
                  // Some responses come split across multiple parts
                  const text = (cand.content?.parts || [])
                    .map(p => (p.text ?? ""))
                    .join("\n");
                
                  const json = extractJson(text);
                  if (!json || !json.title || !json.body || !Array.isArray(json.questions)) {
                    console.error("[Gemini] Invalid/Non-JSON response:", text);
                    throw new Error("Invalid JSON shape from Gemini");
                  }
                  return json;
                }

        
            // 6) Local fallback: shown if API fails
            const fallback = {
                paradox: [
                    {
                        title: "The Mirror That Remembers",
                        body: "A ship sails for a century; each plank is replaced. In a museum, artisans assemble the discarded planks. Which is Theseus’s ship? If identity lives in continuity, the sea-worn vessel wins. If identity lives in matter, the museum claims it. And if identity needs both, perhaps there was never a single ship—only overlapping histories we mistake for a thing.",
                        questions: [
                            "Where does identity ‘live’: function, matter, or memory?",
                            "If you forget a past self, are you less you?",
                            "What exactly is preserved when names persist?"
                        ]
                    }
                ],
                dilemma: [
                    {
                        title: "The Switch and the Bridge",
                        body: "A runaway train will kill five unless you pull a switch, diverting it toward one. Same numbers, but a second case asks you to push a man to stop it. If consequences alone decide, both acts align. If intentions and roles matter, the symmetry breaks—ethics lives where math and meaning quarrel.",
                        questions: [
                            "Do outcomes outweigh how those outcomes are produced?",
                            "Is omission morally different from action?",
                            "What role do norms about ‘using’ people play?"
                        ]
                    }
                ],
                thought: [
                    {
                        title: "Maria’s Room",
                        body: "Maria knows every physical fact about color but has never seen it. When she sees a red rose, does she learn something new? If yes, physics wasn’t complete; if no, experience seems redundant. Maybe we confuse describing a phenomenon from the outside with inhabiting it from within.",
                        questions: [
                            "Can a fact be knowable only by having it?",
                            "Is ‘what it’s like’ a distinct kind of information?",
                            "Does explanation require experience?"
                        ]
                    }
                ],
                dialogue: [
                    {
                        title: "On Freedom",
                        body: [
                            "A: I act freely when I get what I want.",
                            "B: Can you choose what you want to want?",
                            "A: I choose among my desires.",
                            "B: Chosen by what—another desire?",
                            "A: By me.",
                            "B: And what shapes that ‘me’?",
                            "A: History, habits, luck—",
                            "B: Then freedom is layered: choosing, and choosing the chooser.",
                            "A: Or owning the causes that own me.",
                            "B: A freedom that admits its chains."
                        ].join("\n"),
                        questions: [
                            "When do you feel most free—why?",
                            "Is authorship over desires required for freedom?",
                            "What would increasing freedom actually change?"
                        ]
                    }
                ]
            };
        
            function pickFallback(mode) {
                const arr = fallback[mode] || fallback.paradox;
                return arr[Math.floor(Math.random() * arr.length)];
            }
        
            // 7) Render helper
            function renderResult(result) {
                titleEl.textContent = result.title;
                contentEl.textContent = result.body;
        
                // Remove any previous questions block
                const old = outputDiv.querySelector('.paradox-questions');
                if (old) old.remove();
        
                // Add reflective questions under the content
                const qWrap = document.createElement('div');
                qWrap.className = 'paradox-questions';
                qWrap.innerHTML = `
                    <hr style="border:0;border-top:1px solid rgba(201,169,97,0.3);margin:1rem 0 .75rem;">
                    <div style="font-family: var(--font-display); font-size: var(--fs-small); color: var(--accent-gold); margin-bottom: .5rem;">
                        Questions to ponder
                    </div>
                `;
                const ul = document.createElement('ul');
                ul.style.listStyle = "disc";
                ul.style.margin = "0 0 0 1.25rem";
                ul.style.padding = "0";
                (result.questions || []).forEach(q => {
                    const li = document.createElement('li');
                    li.style.margin = ".35rem 0";
                    li.textContent = q;
                    ul.appendChild(li);
                });
                qWrap.appendChild(ul);
                outputDiv.appendChild(qWrap);
        
                outputDiv.classList.remove('hidden');
            }
        
            // 8) Wire up UI
            complexitySlider.addEventListener('input', (e) => {
                state.complexity = parseInt(e.target.value);
                complexityValue.textContent = state.complexity;
            });
            abstractionSlider.addEventListener('input', (e) => {
                state.abstraction = parseInt(e.target.value);
                abstractionValue.textContent = state.abstraction;
            });
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentMode = e.target.dataset.mode;
                });
            });
        
            // 9) Generate
            generateBtn.addEventListener('click', async () => {
                const c = state.complexity || 3;
                const a = state.abstraction || 3;
        
                // spinner
                outputDiv.classList.remove('hidden');
                titleEl.textContent = `${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)} (C:${c} A:${a})`;
                contentEl.innerHTML = `<div class="loading" aria-label="loading"></div>`;
        
                try {
                    const json = await generateWithGemini(currentMode, c, a);
                    renderResult(json);
                    } catch (err) {
                  console.warn("[Paradox fallback] Reason:", err);
                  const fb = pickFallback(currentMode);
                  renderResult(fb);
                }
            });
        }
        // Arabic Poetry Generator
        function initArabicPoetry() {
            const btn = document.getElementById('generate-poem');
            const text = document.getElementById('poem-text');
            
            const poems = [
                "يا نجمةً في ليلِ روحي تضيءُ\nأنتِ الهوى والشوقُ والأشياءُ\nفي عينيكِ بحرٌ من حنينٍ\nوفي صوتِكِ ألفُ صحراءُ",
                
                "الحبُّ موتٌ صغيرٌ نختارُهُ\nونحيا به رغمَ الجراحِ\nكأنّ القلوبَ مساكنٌ\nلا تُضاءُ إلا بالافتضاحِ",
                
                "أحملُ في قلبي وطناً\nاسمُه أنتِ يا ماريا\nكلُّ المُدنِ تشبهُكِ\nوكلُّ الدروبِ تؤدّي إلى عينيكِ",
                
                "الوقتُ يمضي والحنينُ يزيدُ\nوأنا على بابِ الهوى عبدُ\nأكتبُ اسمَكِ بالنجومِ\nعلّ السماءَ تعيدُ ما تُريدُ",
                
                "في غيابِكِ أتعلّمُ الموتَ\nحرفاً حرفاً، دمعةً دمعةً\nوفي حضورِكِ أنسى\nكلَّ ما تعلّمتُ عن الحياةِ",
                
                "أنتِ القصيدةُ التي\nعجزَ الشعراءُ عن كتابتِها\nوأنا المجنونُ الذي\nيحاولُ عدَّ نجومِ السماءِ",
                
                "بينَ قلبي وقلبِكِ\nمسافةُ كُنْ فيكونُ\nأقربُ من نَفَسي\nوأبعدُ من كلِّ الظنونِ",
                
                "يا مَن جعلتِ من الغيابِ حضوراً\nومن الصمتِ كلاماً\nعلّميني كيفَ أحيا\nبنصفِ روحٍ ونصفِ غرامٍ",
                
                "الليلُ يسألُني عنكِ\nوالقمرُ يحسدُني عليكِ\nوأنا بينَ السؤالِ والحسدِ\nأموتُ وأحيا في يديكِ",
                
                "كُتِبَ عليَّ أن أهواكِ\nمنذُ الأزلِ حتى الأبدِ\nوما بينَ الأزلِ والأبدِ\nعمرٌ لا يكفي لأعبُدَكِ"
            ];
            
            btn.addEventListener('click', () => {
                const poem = poems[Math.floor(Math.random() * poems.length)];
                text.style.opacity = '0';
                setTimeout(() => {
                    text.textContent = poem;
                    text.style.opacity = '1';
                }, 300);
            });
        }

        // Dark Radio with Original Design
        function initDarkRadio() {
            const powerBtn = document.getElementById('power-btn');
            const scanBtn = document.getElementById('scan-btn');
            const tunerKnob = document.getElementById('tuner-knob');
            const transcriptText = document.getElementById('transcript-text');
            const stationName = document.getElementById('station-name');
            const frequencyDisplay = document.getElementById('frequency-display');
            const frequencyMarker = document.getElementById('frequency-marker');
            const visualizerCanvas = document.getElementById('audio-visualizer');
            const ctx = visualizerCanvas.getContext('2d');
            let typeTimeout = null;
            let typeSession = 0;
            const stations = [
                { freq: 88.5, name: 'VOID.FM', type: 'Existential' },
                { freq: 90.3, name: 'ABYSS.FM', type: 'Nihilistic' },
                { freq: 92.1, name: 'SHADOW.FM', type: 'Psychological' },
                { freq: 94.7, name: 'DOOM.FM', type: 'Apocalyptic' },
                { freq: 96.6, name: 'HELL.FM', type: 'Infernal' },
                { freq: 98.9, name: 'DEATH.FM', type: 'Mortality' },
                { freq: 101.1, name: 'MADNESS.FM', type: 'Insanity' },
                { freq: 103.3, name: 'TRAUMA.FM', type: 'Memory' },
                { freq: 105.5, name: 'SILENCE.FM', type: 'Emptiness' },
                { freq: 107.7, name: 'END.FM', type: 'Finality' }
            ];
            
            const broadcasts = {
                'Existential': [
                    "You are a cosmic accident, a brief arrangement of atoms pretending to have meaning. The universe was fine without you for 14 billion years and won't notice when you're gone.",
                    "Free will is an illusion. Every thought you have is the result of prior causes stretching back to the Big Bang. You're a puppet who can see the strings but can't stop dancing.",
                    "Everyone you love will die. Some before you, leaving you to grieve. Some after you, and you'll abandon them to grief. Love is just setting yourself up for inevitable loss.",
                    "Your consciousness is a hallucination. The 'self' is just a story your brain tells itself. You don't exist in any meaningful way—you're just matter pretending to matter."
                ],
                'Nihilistic': [
                    "Nothing you do will be remembered in 1000 years. Your greatest achievements will be dust, your name forgotten, your impact erased. You're just killing time until time kills you.",
                    "Morality is a collective delusion. There's no cosmic judge, no karmic balance. The universe rewards cruelty as often as kindness. Ethics are just opinions with better PR.",
                    "Life has no inherent purpose. You weren't meant to be here. There's no plan, no destiny, no reason. You're a random fluctuation in entropy, signifying nothing.",
                    "Hope is the cruelest lie we tell ourselves. It keeps us suffering when we should surrender. The future will disappoint you just like the past did."
                ],
                'Psychological': [
                    "Your personality is just a trauma response that got comfortable. Every quirk you think makes you unique is actually damage you're too afraid to heal.",
                    "You're not as good a person as you think. Your brain rewrites memories to make you the hero. In someone else's story, you're the villain.",
                    "The voice in your head isn't you—it's an echo of everyone who ever hurt you. You're haunted by ghosts that use your mouth to speak.",
                    "Mental illness isn't a bug; it's a feature. Depression sees reality clearly. Anxiety predicts accurately. Sanity is just functional delusion."
                ],
                'Apocalyptic': [
                    "Civilization is three meals away from collapse. The thin veneer of order could shatter any moment. Beneath our civility lurks primordial violence.",
                    "Climate change is irreversible. We've already triggered feedback loops that will make Earth uninhabitable. You're living in the last days of a dying world.",
                    "Nuclear weapons still exist, thousands of them, waiting. One miscalculation, one malfunction, and everything ends in fire and radiation.",
                    "The next pandemic could be the last. Antibiotic resistance, bioweapons, or nature's next surprise—humanity's end might already be mutating somewhere."
                ],
                'Infernal': [
                    "Hell is other people, but worse—hell is yourself. You are your own eternal torment, trapped forever with the person you hate most: you.",
                    "Every comfort is built on someone else's suffering. Your clothes, food, technology—all made possible by exploitation you choose to ignore.",
                    "The worst part about evil is how ordinary it is. Monsters look like neighbors, smile like friends. Atrocity happens in daylight, documented and ignored.",
                    "You carry hell with you. It's in every regret, every shameful memory, every moment you failed to be who you pretended to be."
                ],
                'Mortality': [
                    "Your body is already dying. Each heartbeat is one fewer. Each breath brings you closer to your last. You're decomposing in slow motion.",
                    "The people you love are dying too. Some quickly, some slowly, all inevitably. Every goodbye could be the last, and you'll never know which one.",
                    "Immortality would be worse than death. Watching everyone you love die, experiencing heat death of the universe, floating alone in infinite darkness forever.",
                    "You won't know when you're dead. One moment you'll exist, the next you won't, with no experience of the transition. You'll never know your story's ending."
                ],
                'Insanity': [
                    "Madness is clarity. What you call sanity is just agreed-upon delusion. The mad see through the veil; that's why we lock them away.",
                    "You can't trust your own mind. Memory lies, perception deceives, reasoning fails. You're trapped in a brain you can't escape and can't rely on.",
                    "Everyone is insane in their own way. We just hide it better than those we institutionalize. Normalcy is performed madness.",
                    "The line between genius and madness is drawn by the mediocre. What we can't understand, we pathologize. Today's madness is tomorrow's breakthrough."
                ],
                'Memory': [
                    "Your past is fiction. Every time you remember, you rewrite the memory. You're nostalgic for events that never happened the way you remember them.",
                    "Trauma rewrites your neural pathways. You're physically scarred by what happened to you. Your brain is a monument to everything that hurt you.",
                    "You'll forget almost everything. The moments you swear you'll remember forever will fade. Your life will compress into a few vague impressions.",
                    "The people who remember you will die, and then you'll be truly gone. First your body, then the memories of you. Complete erasure is coming."
                ],
                'Emptiness': [
                    "Between thoughts is void. Between heartbeats is death. You're mostly empty space pretending to be solid, mostly nothing pretending to be something.",
                    "Silence isn't peaceful—it's the sound of absence. In true quiet, you hear the nothing that waits to reclaim everything.",
                    "The void doesn't stare back—it swallows. You've been falling into it since birth. Everything you do is just distraction from the emptiness.",
                    "Connection is impossible. We're all locked in our own skulls, guessing at what others feel. Every relationship is two people alone together."
                ],
                'Finality': [
                    "There are no second chances. Every moment you waste is gone forever. Every opportunity missed is permanently lost. Time only moves forward.",
                    "Endings don't care if you're ready. Death, loss, failure—they come when they come. Closure is a myth; most things end badly and suddenly.",
                    "The last time is never marked. You've already done thousands of things for the last time without knowing it. The final anything rarely announces itself.",
                    "Everything ends. Every civilization, every star, every atom will decay. The universe itself will end in heat death. Nothing escapes entropy."
                ]
            };
            
            let isDragging = false;
            let startAngle = 0;
            let currentAngle = 0;
            
            function findNearestStation(freq) {
                return stations.reduce((nearest, station) => {
                    const nearestDiff = Math.abs(nearest.freq - freq);
                    const stationDiff = Math.abs(station.freq - freq);
                    return stationDiff < nearestDiff ? station : nearest;
                });
            }
            
            function tuneToFrequency(freq) {
              state.currentFrequency = freq;
              frequencyDisplay.textContent = freq.toFixed(1);
              frequencyMarker.style.left = `${((freq - 88) / 20) * 100}%`;
            
              const station = stations.find(s => Math.abs(s.freq - freq) < 0.5);
            
              if (station && state.isPowered) {
                if (!state.currentStation || state.currentStation.name !== station.name) {
                  stationName.textContent = station.name;
                  state.currentStation = station;
            
                  const messages = broadcasts[station.type];
                  const message = messages[Math.floor(Math.random() * messages.length)];
                  typeMessage(message);
                }
              } else if (state.isPowered) {
                stationName.textContent = 'STATIC';
                state.currentStation = null;
                transcriptText.textContent = '*static* .searching for signal in the darkness.';
              }
            }

            
            function typeMessage(text) {
              typeSession++;                    // new session id
              const mySession = typeSession;
            
              if (typeTimeout) {                // cancel any previous tick
                clearTimeout(typeTimeout);
                typeTimeout = null;
              }
            
              transcriptText.textContent = '';
              let i = 0;
            
              const tick = () => {
                // abort if a new session started or radio got powered off
                if (mySession !== typeSession || !state.isPowered) return;
            
                if (i < text.length) {
                  transcriptText.textContent += text[i++];
                  typeTimeout = setTimeout(tick, 30 + Math.random() * 50);
                }
              };
              tick();
            }

            
            // Visualizer
            function animateVisualizer() {
                visualizerCanvas.width = visualizerCanvas.offsetWidth;
                visualizerCanvas.height = visualizerCanvas.offsetHeight;
                
                function draw() {
                    ctx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
                    
                    if (state.isPowered) {
                        const bars = 32;
                        const barWidth = visualizerCanvas.width / bars;
                        
                        for (let i = 0; i < bars; i++) {
                            const height = Math.random() * visualizerCanvas.height * 0.7;
                            const x = i * barWidth;
                            const y = visualizerCanvas.height - height;
                            
                            const gradient = ctx.createLinearGradient(0, y, 0, visualizerCanvas.height);
                            gradient.addColorStop(0, 'rgba(201, 169, 97, 0.8)');
                            gradient.addColorStop(1, 'rgba(201, 169, 97, 0.2)');
                            
                            ctx.fillStyle = gradient;
                            ctx.fillRect(x, y, barWidth - 2, height);
                        }
                    }
                    
                    requestAnimationFrame(draw);
                }
                draw();
            }
            
            powerBtn.addEventListener('click', () => {
                state.isPowered = !state.isPowered;
                powerBtn.classList.toggle('active');
                
                if (!state.isPowered) {
                    transcriptText.textContent = '*powered off*';
                    stationName.textContent = '---';
                    frequencyDisplay.textContent = '---';
                } else {
                    tuneToFrequency(state.currentFrequency);
                }
            });
            
            scanBtn.addEventListener('click', () => {
                if (!state.isPowered) return;
                
                let scanning = true;
                let scanCount = 0;
                const scanInterval = setInterval(() => {
                    const randomFreq = 88 + Math.random() * 20;
                    frequencyDisplay.textContent = randomFreq.toFixed(1);
                    frequencyMarker.style.left = `${((randomFreq - 88) / 20) * 100}%`;
                    
                    scanCount++;
                    if (scanCount > 10) {
                        clearInterval(scanInterval);
                        const randomStation = stations[Math.floor(Math.random() * stations.length)];
                        tuneToFrequency(randomStation.freq);
                    }
                }, 100);
            });
            
            // Tuner knob control
            tunerKnob.addEventListener('mousedown', (e) => {
                if (!state.isPowered) return;
                isDragging = true;
                const rect = tunerKnob.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                startAngle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                const rect = tunerKnob.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const angle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
                const deltaAngle = angle - startAngle;
                currentAngle += deltaAngle;
                startAngle = angle;
                
                tunerKnob.style.transform = `rotate(${currentAngle}rad)`;
                
                const freqDelta = deltaAngle * 5;
                const newFreq = Math.max(88, Math.min(108, state.currentFrequency + freqDelta));
                tuneToFrequency(newFreq);
            });
            
            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    // Snap to nearest station
                    const nearest = findNearestStation(state.currentFrequency);
                    tuneToFrequency(nearest.freq);
                }
            });
            
            animateVisualizer();
        }

        function initFloatingParticles() {
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.cssText = `width:${Math.random()*4+1}px;height:${Math.random()*4+1}px;background:var(--accent-gold);left:${Math.random()*window.innerWidth}px;animation-duration:${Math.random()*20+20}s;animation-delay:${Math.random()*20}s`;
                document.body.appendChild(particle);
            }
        }
    </script>
</body>
</html>
