<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maria — Celestial Symphony</title>
    <meta name="description" content="An immersive digital experience crafted for Maria">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>⭐</text></svg>">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,opsz,wght@0,6..96,200..900;1,6..96,200..900&family=Crimson+Pro:ital,wght@0,200..900;1,200..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Amiri:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --base-light: #faf8f6;
            --base-dark: #f5f1ed;
            --text-primary: #0a0a0a;
            --text-secondary: rgba(10, 10, 10, 0.7);
            --accent-gold: #c9a961;
            --accent-gold-dark: #a88545;
            --gray-muted: #e3ddd7;
            --charcoal: #2a2928;
            
            --font-display: 'Bodoni Moda', serif;
            --font-body: 'Crimson Pro', serif;
            --font-mono: 'JetBrains Mono', monospace;
            
            --fs-hero: clamp(3rem, 8vw, 6rem);
            --fs-title: clamp(2rem, 5vw, 3.5rem);
            --fs-heading: clamp(1.5rem, 3vw, 2.5rem);
            --fs-body: clamp(1rem, 2vw, 1.25rem);
            --fs-small: clamp(0.875rem, 1.5vw, 1rem);
            
            --space-xs: clamp(0.5rem, 1vw, 1rem);
            --space-sm: clamp(1rem, 2vw, 1.5rem);
            --space-md: clamp(2rem, 4vw, 3rem);
            --space-lg: clamp(3rem, 6vw, 5rem);
            --space-xl: clamp(4rem, 8vw, 8rem);
            
            --blur-subtle: 10px;
            --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.1);
            --shadow-glow: 0 0 30px rgba(201, 169, 97, 0.3);
            
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-spring: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --base-light: #1a1918;
                --base-dark: #0f0e0e;
                --text-primary: #faf8f6;
                --text-secondary: rgba(250, 248, 246, 0.7);
                --gray-muted: #3a3836;
            }
        }

        html {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        body {
            font-family: var(--font-body);
            font-weight: 400;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(180deg, var(--base-light) 0%, var(--base-dark) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-muted);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-gold);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-gold-dark);
        }

        ::selection {
            background: var(--accent-gold);
            color: var(--base-light);
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-display);
            font-weight: 300;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }

        h1 { font-size: var(--fs-hero); }
        h2 { font-size: var(--fs-title); }
        h3 { font-size: var(--fs-heading); }

        p {
            font-size: var(--fs-body);
            margin-bottom: var(--space-sm);
        }

        .mono {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            letter-spacing: 0.05em;
        }

        .container {
            width: 90%;
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-md) 0;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(var(--blur-subtle));
            -webkit-backdrop-filter: blur(var(--blur-subtle));
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: var(--shadow-soft);
        }

        .hidden {
            display: none;
        }

        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.03;
            z-index: 1000;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='1'/%3E%3C/svg%3E");
        }

        .cursor {
            width: 20px;
            height: 20px;
            border: 2px solid var(--accent-gold);
            border-radius: 50%;
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            transition: transform 0.15s ease-out;
            mix-blend-mode: difference;
        }

        .cursor-dot {
            width: 4px;
            height: 4px;
            background: var(--accent-gold);
            border-radius: 50%;
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            mix-blend-mode: difference;
        }

        header {
            height: 100vh;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #cosmic-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            padding: var(--space-md);
        }

        .hero-title {
            font-weight: 200;
            margin-bottom: var(--space-md);
            opacity: 0;
            animation: fadeInUp 1.5s ease-out forwards;
        }

        .hero-quote {
            font-size: var(--fs-heading);
            font-style: italic;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
            opacity: 0;
            animation: fadeInUp 1.5s ease-out 0.5s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
            from {
                opacity: 0;
                transform: translateY(30px);
            }
        }

        nav {
            position: fixed;
            top: 50%;
            right: 2rem;
            transform: translateY(-50%);
            z-index: 100;
        }

        .nav-orbs {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            position: relative;
        }

        .nav-orb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-gold);
            cursor: pointer;
            position: relative;
            transition: var(--transition-spring);
        }

        .nav-orb::before {
            content: attr(data-label);
            position: absolute;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--charcoal);
            color: var(--base-light);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition-smooth);
        }

        .nav-orb:hover {
            transform: scale(2);
            box-shadow: var(--shadow-glow);
        }

        .nav-orb:hover::before {
            opacity: 1;
            right: 2.5rem;
        }

        .nav-lines {
            position: absolute;
            top: 0;
            left: 50%;
            width: 1px;
            height: 100%;
            background: linear-gradient(to bottom, transparent, var(--accent-gold), transparent);
            opacity: 0.3;
            transform: translateX(-50%);
        }

        section {
            min-height: 100vh;
            padding: var(--space-xl) 0;
            position: relative;
            border-bottom: 1px solid rgba(201, 169, 97, 0.1);
        }

        section:last-of-type {
            border-bottom: none;
        }

        .section-title {
            text-align: center;
            margin-bottom: var(--space-lg);
            font-weight: 300;
        }

        #constellations {
            background: radial-gradient(ellipse at center, rgba(42, 41, 40, 0.1) 0%, transparent 70%);
        }

        #constellation-canvas {
            width: 100%;
            height: 600px;
            border-radius: 20px;
            cursor: crosshair;
            position: relative;
        }

        .constellation-info {
            text-align: center;
            margin-top: var(--space-md);
            padding: 1rem 2rem;
            border-radius: 10px;
            font-family: var(--font-mono);
            transition: var(--transition-smooth);
        }

        /* Music Player Styles */
        .music-interface {
            max-width: 900px;
            margin: 0 auto;
        }

        .music-player {
            padding: var(--space-lg);
            border-radius: 30px;
            background: linear-gradient(135deg, rgba(42, 41, 40, 0.2) 0%, rgba(201, 169, 97, 0.1) 100%);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .spotify-main-player {
            margin-bottom: var(--space-md);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            min-height: 352px;
        }

        /* NEW: Style for the Spotify embed container */
        #embed-iframe {
            width: 100%;
            height: 352px;
            border-radius: 12px;
        }

        /* NEW: Loading animation */
        .spotify-main-player.loading::after {
            content: '♪ Loading track...';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: var(--font-mono);
            color: var(--accent-gold);
            font-size: var(--fs-small);
            animation: pulse 1s ease-in-out infinite;
        }

        .playlist-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: var(--space-md);
            max-height: 400px;
            overflow-y: auto;
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid rgba(201, 169, 97, 0.2);
        }

        .playlist-header h4 {
            font-family: var(--font-display);
            font-size: var(--fs-body);
            font-weight: 300;
            margin: 0;
        }

        .track-count {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            color: var(--text-secondary);
        }

        .playlist-items {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .playlist-item {
            display: grid;
            grid-template-columns: 30px 1fr auto;
            gap: var(--space-sm);
            padding: var(--space-sm);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .playlist-item:hover {
            background: rgba(201, 169, 97, 0.1);
            transform: translateX(5px);
        }

        .playlist-item.active {
            background: rgba(201, 169, 97, 0.2);
            border-left: 3px solid var(--accent-gold);
        }

        /* NEW: Playing animation */
        .playlist-item.playing .playlist-number {
            color: var(--accent-gold);
            font-weight: bold;
        }

        .playlist-number {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            color: var(--text-secondary);
            text-align: center;
        }

        .playlist-track-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            min-width: 0;
        }

        .playlist-track-title {
            font-size: var(--fs-small);
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .playlist-track-artist {
            font-size: 0.875rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .playlist-track-duration {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            color: var(--text-secondary);
        }

        .audio-source-note {
            text-align: center;
            margin-top: var(--space-md);
            color: var(--text-secondary);
        }

        /* NEW: Info for non-premium users */
        .spotify-notice {
            background: rgba(201, 169, 97, 0.1);
            border: 1px solid var(--accent-gold);
            border-radius: 10px;
            padding: var(--space-sm);
            margin-top: var(--space-sm);
            font-size: var(--fs-small);
            text-align: center;
            color: var(--accent-gold);
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        #chamber {
            background: linear-gradient(135deg, rgba(201, 169, 97, 0.05) 0%, transparent 50%);
        }

        .essay-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-md);
            perspective: 1000px;
        }

        .essay-card {
            background: var(--base-light);
            border-radius: 15px;
            padding: var(--space-md);
            cursor: pointer;
            transform-style: preserve-3d;
            transition: var(--transition-spring);
            position: relative;
            overflow: hidden;
        }

        .essay-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(201, 169, 97, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .essay-card:hover::before {
            transform: translateX(100%);
        }

        .essay-card:hover {
            transform: rotateY(5deg) rotateX(-5deg) translateZ(20px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .essay-title {
            font-size: var(--fs-heading);
            margin-bottom: var(--space-sm);
            color: var(--accent-gold-dark);
        }

        .essay-excerpt {
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .essay-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition-smooth);
        }

        .essay-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .essay-content {
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            padding: var(--space-lg);
            background: var(--base-light);
            border-radius: 20px;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            border: none;
            background: var(--accent-gold);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--base-light);
            transition: var(--transition-smooth);
        }

        .close-modal:hover {
            transform: rotate(90deg);
            background: var(--accent-gold-dark);
        }

        #paradox {
            background: linear-gradient(135deg, rgba(42, 41, 40, 0.1) 0%, transparent 50%, rgba(42, 41, 40, 0.1) 100%);
        }

        .paradox-interface {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--space-lg);
            border-radius: 20px;
        }

        .paradox-controls {
            display: grid;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .paradox-mode-selector {
            display: flex;
            justify-content: center;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: 1px solid rgba(201, 169, 97, 0.5);
            color: var(--text-secondary);
            border-radius: 25px;
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .mode-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
            background: rgba(201, 169, 97, 0.1);
        }

        .mode-btn.active {
            background: var(--accent-gold);
            color: var(--base-light);
            border-color: var(--accent-gold);
        }

        .paradox-concepts {
            text-align: center;
        }

        .concepts-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: var(--space-xs);
            margin-top: var(--space-xs);
            min-height: 40px;
        }

        .concept-tag {
            padding: 0.5rem 1rem;
            background: rgba(201, 169, 97, 0.2);
            border: 1px solid var(--accent-gold);
            color: var(--accent-gold);
            border-radius: 20px;
            font-size: var(--fs-small);
            font-family: var(--font-mono);
            position: relative;
            overflow: hidden;
        }

        .paradox-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            margin: 0 auto;
            padding: 1rem 3rem;
            background: transparent;
            border: 2px solid var(--accent-gold);
            color: var(--accent-gold);
            font-family: var(--font-display);
            font-size: var(--fs-body);
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .paradox-button:hover {
            background: var(--accent-gold);
            color: var(--base-light);
            transform: scale(1.05);
        }

        .paradox-icon {
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .paradox-output {
            margin-top: var(--space-lg);
            padding: var(--space-lg);
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(201, 169, 97, 0.3);
            border-radius: 20px;
        }

        .paradox-title {
            font-family: var(--font-display);
            font-size: var(--fs-heading);
            color: var(--accent-gold);
            text-align: center;
            margin-bottom: var(--space-md);
        }

        .paradox-content {
            font-size: var(--fs-body);
            line-height: 1.8;
            margin-bottom: var(--space-md);
        }

        .paradox-questions {
            padding: var(--space-md);
            background: rgba(201, 169, 97, 0.1);
            border-radius: 15px;
        }

        .paradox-questions h4 {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            color: var(--accent-gold);
            margin-bottom: var(--space-sm);
        }

        .paradox-questions ul {
            list-style: none;
        }

        .paradox-questions li {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
            font-style: italic;
            color: var(--text-secondary);
        }

        .paradox-questions li::before {
            content: '→';
            position: absolute;
            left: 0;
            color: var(--accent-gold);
        }

        #wisdom {
            background: linear-gradient(135deg, rgba(42, 41, 40, 0.1) 0%, transparent 50%, rgba(42, 41, 40, 0.1) 100%);
        }

        #poems {
            background: linear-gradient(to bottom, rgba(227, 221, 215, 0.2) 0%, transparent 100%);
        }

        .poem-interface {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .poem-display {
            padding: var(--space-lg);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin-bottom: var(--space-md);
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .poem-content {
            font-size: var(--fs-body);
            line-height: 2;
            white-space: pre-line;
            color: var(--text-primary);
            max-width: 800px;
            margin: 0 auto;
            transition: opacity 0.5s ease;
        }

        .poem-btn {
            padding: 1rem 2rem;
            background: transparent;
            border: 2px solid var(--accent-gold);
            color: var(--accent-gold);
            font-family: var(--font-display);
            font-size: var(--fs-body);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .poem-btn:hover {
            background: var(--accent-gold);
            color: var(--base-light);
        }

        #facts {
            background: linear-gradient(to bottom, 
                rgba(0, 0, 0, 0.3) 0%, 
                rgba(20, 20, 40, 0.2) 50%, 
                rgba(0, 0, 0, 0.4) 100%);
            position: relative;
            overflow: hidden;
        }

        #facts::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, transparent 0%, rgba(0, 0, 0, 0.4) 100%);
            pointer-events: none;
        }

        .radio-interface {
            max-width: 1000px;
            margin: 0 auto;
        }

        .radio-device {
            padding: var(--space-lg);
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 20px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            margin-bottom: var(--space-md);
        }

        .radio-display {
            background: #0a0a0a;
            padding: var(--space-md);
            border-radius: 15px;
            margin-bottom: var(--space-md);
            box-shadow: inset 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .frequency-band {
            position: relative;
            height: 40px;
            background: linear-gradient(90deg, 
                #2a4a2a 0%, 
                #3a5a3a 25%, 
                #4a6a4a 50%, 
                #3a5a3a 75%, 
                #2a4a2a 100%);
            border-radius: 5px;
            margin-bottom: var(--space-sm);
            overflow: hidden;
        }

        .frequency-marker {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 100%;
            background: var(--accent-gold);
            box-shadow: 0 0 10px var(--accent-gold);
            transition: left 0.3s ease;
        }

        .frequency-numbers {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            color: #4a6a4a;
            font-family: var(--font-mono);
            font-size: 0.75rem;
        }

        .station-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .station-name {
            font-family: var(--font-mono);
            font-size: var(--fs-heading);
            color: var(--accent-gold);
            text-shadow: 0 0 20px var(--accent-gold);
            letter-spacing: 0.2em;
        }

        .frequency-display {
            font-family: var(--font-mono);
            font-size: var(--fs-body);
            color: #4a6a4a;
        }

        .radio-visualizer {
            position: relative;
            height: 150px;
            background: #0a0a0a;
            border-radius: 10px;
            margin-bottom: var(--space-md);
            overflow: hidden;
            box-shadow: inset 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        #audio-visualizer {
            width: 100%;
            height: 100%;
        }

        .static-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(255, 255, 255, 0.03) 2px,
                    rgba(255, 255, 255, 0.03) 4px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 2px,
                    rgba(255, 255, 255, 0.03) 2px,
                    rgba(255, 255, 255, 0.03) 4px
                );
            pointer-events: none;
            animation: static-drift 10s linear infinite;
        }

        @keyframes static-drift {
            0% { transform: translate(0, 0); }
            100% { transform: translate(10px, 10px); }
        }

        .radio-controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: var(--space-md);
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border-radius: 15px;
            margin-bottom: var(--space-md);
        }

        .radio-btn {
            padding: 1rem 2rem;
            background: #1a1a1a;
            border: 2px solid #3a3a3a;
            color: #8a8a8a;
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
        }

        .radio-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
            box-shadow: 0 0 20px rgba(201, 169, 97, 0.2);
        }

        .power-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .power-led {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ff3333;
            box-shadow: 0 0 10px #ff3333;
            transition: var(--transition-smooth);
        }

        .power-btn.active .power-led {
            background: #33ff33;
            box-shadow: 0 0 20px #33ff33;
        }

        .tuner-knob {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle at 30% 30%, #4a4a4a 0%, #1a1a1a 100%);
            border-radius: 50%;
            position: relative;
            cursor: grab;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 -2px 5px rgba(0, 0, 0, 0.5);
        }

        .tuner-knob:active {
            cursor: grabbing;
        }

        .knob-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 20px;
            background: var(--accent-gold);
            border-radius: 2px;
            box-shadow: 0 0 10px var(--accent-gold);
        }

        .broadcast-info {
            display: flex;
            justify-content: space-between;
            padding: var(--space-sm);
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            color: #6a6a6a;
        }

        .broadcast-type {
            color: var(--accent-gold);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .transcript-display {
            padding: var(--space-lg);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            margin-bottom: var(--space-md);
            min-height: 200px;
        }

        .transcript-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid rgba(201, 169, 97, 0.2);
        }

        .transcript-title {
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
        }

        .signal-strength {
            display: flex;
            gap: 3px;
            align-items: flex-end;
        }

        .signal-bar {
            width: 4px;
            height: 20px;
            background: #3a3a3a;
            transition: var(--transition-smooth);
        }

        .signal-bar:nth-child(1) { height: 8px; }
        .signal-bar:nth-child(2) { height: 12px; }
        .signal-bar:nth-child(3) { height: 16px; }
        .signal-bar:nth-child(4) { height: 20px; }

        .signal-strength.strong .signal-bar {
            background: var(--accent-gold);
            box-shadow: 0 0 5px var(--accent-gold);
        }

        .transcript-content {
            min-height: 150px;
            margin-bottom: var(--space-md);
        }

        .transcript-text {
            font-size: var(--fs-body);
            line-height: 1.8;
            color: var(--text-primary);
            font-style: italic;
        }

        .transcript-text.typing::after {
            content: '|';
            animation: blink 1s infinite;
            color: var(--accent-gold);
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .transcript-metadata {
            display: flex;
            justify-content: space-between;
            font-family: var(--font-mono);
            font-size: var(--fs-small);
            color: var(--text-secondary);
        }

        .saved-transmissions {
            margin-top: var(--space-lg);
            padding: var(--space-lg);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
        }

        .transmissions-title {
            font-family: var(--font-display);
            font-size: var(--fs-heading);
            text-align: center;
            margin-bottom: var(--space-md);
            color: var(--accent-gold);
        }

        .transmissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--space-sm);
        }

        .saved-transmission {
            padding: var(--space-sm);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(201, 169, 97, 0.2);
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .saved-transmission:hover {
            background: rgba(201, 169, 97, 0.1);
            transform: translateY(-2px);
        }

        .transmission-preview {
            font-size: var(--fs-small);
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            font-style: italic;
        }

        .transmission-meta {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: var(--accent-gold);
            margin-top: 0.5rem;
        }

        footer {
            min-height: 30vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--charcoal);
            color: var(--base-light);
            overflow: hidden;
        }

        .footer-content {
            text-align: center;
        }

        .footer-content p {
            color: var(--accent-gold);
        }

        .particle {
            position: fixed;
            pointer-events: none;
            opacity: 0.5;
            animation: floatParticle 20s infinite;
        }

        @keyframes floatParticle {
            0%, 100% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.5;
            }
            90% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-100vh) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        .loading {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(201, 169, 97, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-gold);
            animation: spin 1s linear infinite;
        }

        @media (max-width: 768px) {
            nav {
                display: none;
            }

            .essay-container {
                grid-template-columns: 1fr;
            }

            #embed-iframe {
                height: 250px !important;
            }

            .playlist-section {
                max-height: 300px;
            }

            .playlist-item {
                grid-template-columns: 25px 1fr auto;
                padding: var(--space-xs);
                font-size: 0.9rem;
            }

            .playlist-track-duration {
                display: none;
            }
            
            /* NEW: Mobile styles for Message Bottles */
            .ocean-scene {
                height: 400px;
            }
            
            .floating-bottle {
                width: 50px;
                height: 100px;
            }
            
            .bottle-stats {
                flex-direction: column;
                gap: var(--space-sm);
            }
            
            .message-display {
                width: 95%;
                padding: var(--space-md);
            }
            
            .collection-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="grain" aria-hidden="true"></div>
    <div class="cursor" aria-hidden="true"></div>
    <div class="cursor-dot" aria-hidden="true"></div>

    <header>
        <canvas id="cosmic-canvas"></canvas>
        <div class="hero-content">
            <h1 class="hero-title">Maria</h1>
            <p class="hero-quote">"We are made of star stuff, contemplating the stars"</p>
        </div>
    </header>

    <nav>
        <div class="nav-orbs">
            <div class="nav-lines"></div>
            <a href="#constellations" class="nav-orb" data-label="Stars"></a>
            <a href="#chamber" class="nav-orb" data-label="Chamber"></a>
            <a href="#music" class="nav-orb" data-label="Music"></a>
            <a href="#paradox" class="nav-orb" data-label="Paradox"></a>
            <a href="#poems" class="nav-orb" data-label="Poetry"></a>
            <a href="#facts" class="nav-orb" data-label="Messages"></a>
        </div>
    </nav>

    <main>
        <section id="constellations" class="fade-in">
            <div class="container">
                <h2 class="section-title">Star Puzzle</h2>
                <p class="mono" style="text-align: center; margin-bottom: var(--space-md);">Connect the stars to reveal a hidden message</p>
                <canvas id="constellation-canvas" class="glass"></canvas>
                <div class="constellation-info glass" id="constellation-info">
                    <p>Find the pattern in the stars...</p>
                </div>
            </div>
        </section>

        <section id="chamber" class="fade-in">
            <div class="container">
                <h2 class="section-title">Chamber of Echoes</h2>
                <div class="essay-container">
                    <article class="essay-card glass">
                        <h3 class="essay-title">On Consciousness</h3>
                        <p class="essay-excerpt">The mirror of awareness reflects not just the world, but the very act of reflection itself...</p>
                    </article>
                    <article class="essay-card glass">
                        <h3 class="essay-title">The Nature of Time</h3>
                        <p class="essay-excerpt">Time flows not as a river, but as an ocean—vast, deep, and full of currents we barely perceive...</p>
                    </article>
                    <article class="essay-card glass">
                        <h3 class="essay-title">Beauty's Whisper</h3>
                        <p class="essay-excerpt">In the fleeting moment of aesthetic arrest, we touch something eternal, something that was always there...</p>
                    </article>
                    <article class="essay-card glass">
                        <h3 class="essay-title">The Gift of Suffering</h3>
                        <p class="essay-excerpt">Pain carves the vessel in which joy is held. Without darkness, light has no meaning...</p>
                    </article>
                    <article class="essay-card glass">
                        <h3 class="essay-title">Love as Verb</h3>
                        <p class="essay-excerpt">Love is not found but forged, not felt but enacted, a daily choice to see the sacred in another...</p>
                    </article>
                    <article class="essay-card glass">
                        <h3 class="essay-title">Dancing with Death</h3>
                        <p class="essay-excerpt">Mortality is the dark backdrop against which life's colors shine most brilliantly...</p>
                    </article>
                </div>
            </div>
        </section>

        <div class="essay-modal">
            <div class="essay-content glass">
                <button class="close-modal">&times;</button>
                <h3 id="modal-title" class="essay-title"></h3>
                <div class="modal-body"></div>
            </div>
        </div>

        <section id="music" class="fade-in">
            <div class="container">
                <h2 class="section-title">Musical Journey</h2>
                <p class="mono" style="text-align: center; margin-bottom: var(--space-md);">Egyptian classics & timeless melodies</p>
                
                <div class="music-interface">
                    <div class="music-player glass">
                        <div class="spotify-main-player">
                            <!-- NEW: Conteneur pour le lecteur Spotify dynamique -->
                            <div id="embed-iframe"></div>
                        </div>
                        
                        <div class="playlist-section" style="margin-top: var(--space-md);">
                            <div class="playlist-header">
                                <h4>Egyptian Classics Collection</h4>
                                <span class="track-count">10 masterpieces</span>
                            </div>
                            <div class="playlist-items" id="playlist-items">
                                <!-- MODIFIED: Ajout des attributs data-id, data-title, data-artist -->
                                <div class="playlist-item active" 
                                     data-id="3gFcGnU4kTdMYLXDjH1TK8"
                                     data-title="Enta Omri"
                                     data-artist="Umm Kulthum">
                                    <div class="playlist-number">1</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Enta Omri</div>
                                        <div class="playlist-track-artist">Umm Kulthum</div>
                                    </div>
                                    <div class="playlist-track-duration">38:31</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="7ouRfMhJnMA3a88VBzByxW"
                                     data-title="Alf Leila wa Leila"
                                     data-artist="Umm Kulthum">
                                    <div class="playlist-number">2</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Alf Leila wa Leila</div>
                                        <div class="playlist-track-artist">Umm Kulthum</div>
                                    </div>
                                    <div class="playlist-track-duration">54:01</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="73bzFhkyCVb4rf65BzwMmt"
                                     data-title="Ahwak"
                                     data-artist="Abdel Halim Hafez">
                                    <div class="playlist-number">3</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Ahwak</div>
                                        <div class="playlist-track-artist">Abdel Halim Hafez</div>
                                    </div>
                                    <div class="playlist-track-duration">4:12</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="6dwvEqcqiMlOUqEgtZq5oR"
                                     data-title="Gana El Hawa"
                                     data-artist="Abdel Halim Hafez">
                                    <div class="playlist-number">4</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Gana El Hawa</div>
                                        <div class="playlist-track-artist">Abdel Halim Hafez</div>
                                    </div>
                                    <div class="playlist-track-duration">6:18</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="0MnG7RgYTmYhPGDbFQasz0"
                                     data-title="Nassam Alayna El Hawa"
                                     data-artist="Fairuz">
                                    <div class="playlist-number">5</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Nassam Alayna El Hawa</div>
                                        <div class="playlist-track-artist">Fairuz</div>
                                    </div>
                                    <div class="playlist-track-duration">3:47</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="7mJszBFgMOIoD72QmVgpxC"
                                     data-title="Ya Msafer"
                                     data-artist="Mohamed Abdel Wahab">
                                    <div class="playlist-number">6</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Ya Msafer</div>
                                        <div class="playlist-track-artist">Mohamed Abdel Wahab</div>
                                    </div>
                                    <div class="playlist-track-duration">5:03</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="6kBG7OOWkbNm0nYQqdHOqL"
                                     data-title="Batwanes Beek"
                                     data-artist="Warda">
                                    <div class="playlist-number">7</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Batwanes Beek</div>
                                        <div class="playlist-track-artist">Warda</div>
                                    </div>
                                    <div class="playlist-track-duration">10:23</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="1yBvomPMq8SJzV6tBhZCCB"
                                     data-title="Ayoun El Alb"
                                     data-artist="Najat Al Saghira">
                                    <div class="playlist-number">8</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Ayoun El Alb</div>
                                        <div class="playlist-track-artist">Najat Al Saghira</div>
                                    </div>
                                    <div class="playlist-track-duration">5:58</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="67OWUJEyH08sNlEG7UQzjz"
                                     data-title="Ya Zahratan Fi Khayali"
                                     data-artist="Farid Al Atrash">
                                    <div class="playlist-number">9</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Ya Zahratan Fi Khayali</div>
                                        <div class="playlist-track-artist">Farid Al Atrash</div>
                                    </div>
                                    <div class="playlist-track-duration">4:37</div>
                                </div>
                                <div class="playlist-item" 
                                     data-id="4vCkQHhNGuyiCMWxNBQ0cP"
                                     data-title="Ya Habibi Taala"
                                     data-artist="Asmahan">
                                    <div class="playlist-number">10</div>
                                    <div class="playlist-track-info">
                                        <div class="playlist-track-title">Ya Habibi Taala</div>
                                        <div class="playlist-track-artist">Asmahan</div>
                                    </div>
                                    <div class="playlist-track-duration">3:12</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="audio-source-note">
                            <p class="mono">♪ Timeless Egyptian Masterpieces ♪</p>
                            <p style="font-size: 0.875rem; margin-top: 1rem; color: var(--text-secondary);">Click any song in the playlist to play</p>
                            <!-- NEW: Message pour les utilisateurs non-premium -->
                            <div class="spotify-notice">
                                <p>🎵 Spotify Premium account recommended for full playback</p>
                                <p style="font-size: 0.75rem; margin-top: 0.5rem;">Free accounts: 30-second preview only</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="paradox" class="fade-in">
            <div class="container">
                <h2 class="section-title">The Paradox Engine</h2>
                <p class="mono" style="text-align: center; margin-bottom: var(--space-md);">Generate philosophical thought experiments</p>
                
                <div class="paradox-interface glass">
                    <div class="paradox-controls">
                        <div class="paradox-mode-selector">
                            <button class="mode-btn active" data-mode="paradox">Paradox</button>
                            <button class="mode-btn" data-mode="dilemma">Ethical Dilemma</button>
                            <button class="mode-btn" data-mode="thought">Thought Experiment</button>
                            <button class="mode-btn" data-mode="dialogue">Socratic Dialogue</button>
                        </div>
                        
                        <div class="paradox-concepts">
                            <p class="mono">Active Concepts:</p>
                            <div id="paradox-concepts-list" class="concepts-display"></div>
                        </div>
                    </div>
                    
                    <button id="generate-paradox" class="paradox-button">
                        <span class="paradox-icon">∞</span>
                        <span>Generate</span>
                        <span class="paradox-icon">∞</span>
                    </button>
                    
                    <div id="paradox-output" class="paradox-output hidden">
                        <div class="paradox-title"></div>
                        <div class="paradox-content"></div>
                        <div class="paradox-questions"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="poems" class="fade-in">
            <div class="container">
                <h2 class="section-title">Poetry for Maria</h2>
                <p class="mono" style="text-align: center; margin-bottom: var(--space-md);">Verses from the heart</p>
                
                <div class="poem-interface">
                    <div class="poem-display glass">
                        <div class="poem-content" id="poem-content" style="font-size: 1.5rem; line-height: 2.5; direction: rtl; font-family: 'Amiri', serif; text-align: right; max-width: 800px;">اضغطي لتقرئي أبياتاً جديدة...</div>
                    </div>
                    <button class="poem-btn" id="generate-poem">أبيات جديدة</button>
                </div>
            </div>
        </section>

        <section id="facts" class="fade-in">
            <div class="container">
                <h2 class="section-title">Midnight Radio</h2>
                <p class="mono" style="text-align: center; margin-bottom: var(--space-md);">Strange frequencies from 3 AM</p>
                
                <div class="radio-interface">
                    <!-- Radio Device -->
                    <div class="radio-device glass">
                        <!-- Frequency Display -->
                        <div class="radio-display">
                            <div class="frequency-band">
                                <div class="frequency-marker" id="frequency-marker"></div>
                                <div class="frequency-numbers">
                                    <span>88</span><span>92</span><span>96</span><span>100</span><span>104</span><span>108</span>
                                </div>
                            </div>
                            <div class="station-display">
                                <div class="station-name" id="station-name">VOID.FM</div>
                                <div class="frequency-display" id="frequency-display">103.7</div>
                            </div>
                        </div>
                        
                        <!-- Visualizer -->
                        <div class="radio-visualizer">
                            <canvas id="audio-visualizer"></canvas>
                            <div class="static-overlay" id="static-overlay"></div>
                        </div>
                        
                        <!-- Radio Controls -->
                        <div class="radio-controls">
                            <button class="radio-btn power-btn" id="power-btn">
                                <div class="power-led"></div>
                            </button>
                            
                            <div class="tuner-knob" id="tuner-knob">
                                <div class="knob-indicator"></div>
                            </div>
                            
                            <button class="radio-btn scan-btn" id="scan-btn">SCAN</button>
                        </div>
                        
                        <!-- Current Broadcast -->
                        <div class="broadcast-info">
                            <div class="broadcast-type" id="broadcast-type">MONOLOGUE</div>
                            <div class="broadcast-time" id="broadcast-time">3:33 AM</div>
                        </div>
                    </div>
                    
                    <!-- Transcript Display -->
                    <div class="transcript-display glass">
                        <div class="transcript-header">
                            <span class="transcript-title">Current Transmission</span>
                            <span class="signal-strength" id="signal-strength">
                                <span class="signal-bar"></span>
                                <span class="signal-bar"></span>
                                <span class="signal-bar"></span>
                                <span class="signal-bar"></span>
                            </span>
                        </div>
                        <div class="transcript-content" id="transcript-content">
                            <p class="transcript-text typing" id="transcript-text">
                                *static* ...tuning into the frequencies between sleep and wake...
                            </p>
                        </div>
                        <div class="transcript-metadata">
                            <span id="word-count">0 words</span>
                            <span id="transmission-number">Transmission #001</span>
                        </div>
                    </div>
                    
                    <!-- Saved Transmissions -->
                    <div class="saved-transmissions hidden" id="saved-transmissions">
                        <h3 class="transmissions-title">Archived Transmissions</h3>
                        <div class="transmissions-grid" id="transmissions-grid"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p class="mono">Created with love for Maria</p>
        </div>
    </footer>

    <!-- NEW: Chargement de l'API Spotify iFrame -->
    <script src="https://open.spotify.com/embed/iframe-api/v1" async></script>

    <script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
    </script>
    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";
        const genAI = new GoogleGenerativeAI('AIzaSyAqXYggfgLt5_dL6wLEkNZUnGXr5QHBch4');
        window.genAI = genAI;
    </script>
    <script>
        const state = {
            mouseX: 0,
            mouseY: 0,
            connections: [],
            solved: false,
            currentTrack: 0,
            isPlaying: false
        };

        document.addEventListener('DOMContentLoaded', () => {
            initCustomCursor();
            initCosmicCanvas();
            initIntersectionObserver();
            initStarPuzzle();
            initEssayCards();
            initParadoxEngine();
            initPoetry();
            initMidnightRadio(); // CHANGED: from initMessageBottles to initMidnightRadio
            initFloatingParticles();
            // REMOVED: initMusicPlayer() sera appelé après le chargement de l'API Spotify
        });

        // NEW: --- 1. Quand l'API est prête, on crée le lecteur ----
        let player;
        let currentURI = null;
        
        window.onSpotifyIframeApiReady = (IFrameAPI) => {
            const element = document.getElementById('embed-iframe');
            // Piste initiale (facultatif)
            currentURI = 'spotify:track:3gFcGnU4kTdMYLXDjH1TK8';
            
            IFrameAPI.createController(element, { 
                uri: currentURI,
                width: '100%',
                height: '352'
            }, (ctrl) => {
                player = ctrl;
                
                // NEW: --- 2. Gestion du clic sur chaque item de la playlist ---
                document.querySelectorAll('.playlist-item').forEach((item) => {
                    item.addEventListener('click', () => {
                        const uri = 'spotify:track:' + item.dataset.id;
                        if (uri === currentURI && state.isPlaying) return; // évite de relancer la même piste
                        
                        currentURI = uri;
                        
                        // Mise à jour visuelle de la sélection
                        document.querySelectorAll('.playlist-item').forEach(i => {
                            i.classList.remove('active');
                            i.classList.remove('playing');
                        });
                        item.classList.add('active');
                        item.classList.add('playing');
                        
                        // Ajout de l'animation de chargement
                        const playerContainer = document.querySelector('.spotify-main-player');
                        playerContainer.classList.add('loading');
                        
                        // Charge et lance la piste
                        player.loadUri(uri); // charge la nouvelle piste
                        player.play(); // lance immédiatement
                        
                        // Màj de l'UI : titre, artiste (si besoin - optionnel car le player Spotify affiche déjà ces infos)
                        // document.getElementById('track-title').textContent = item.dataset.title;
                        // document.getElementById('track-artist').textContent = item.dataset.artist;
                        
                        state.isPlaying = true;
                        state.currentTrack = Array.from(document.querySelectorAll('.playlist-item')).indexOf(item);
                        
                        // Retirer l'animation de chargement après un court délai
                        setTimeout(() => {
                            playerContainer.classList.remove('loading');
                        }, 500);
                        
                        // Scroll vers le player
                        playerContainer.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                    });
                });
                
                // NEW: Optionnel - Gestion des erreurs de lecture
                player.addListener('playback_update', e => {
                    state.isPlaying = !e.data.isPaused;
                });
                
                player.addListener('ready', () => {
                    console.log('Spotify player ready');
                });
            });
        };

        function initCustomCursor() {
            const cursor = document.querySelector('.cursor');
            const cursorDot = document.querySelector('.cursor-dot');
            
            document.addEventListener('mousemove', (e) => {
                state.mouseX = e.clientX;
                state.mouseY = e.clientY;
                cursor.style.left = e.clientX - 10 + 'px';
                cursor.style.top = e.clientY - 10 + 'px';
                cursorDot.style.left = e.clientX - 2 + 'px';
                cursorDot.style.top = e.clientY - 2 + 'px';
            });
        }

        function initCosmicCanvas() {
            const canvas = document.getElementById('cosmic-canvas');
            const ctx = canvas.getContext('2d');
            let bgStars = [];

            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                initBackgroundStars();
            }

            function initBackgroundStars() {
                bgStars = [];
                for (let i = 0; i < 200; i++) {
                    bgStars.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        radius: Math.random() * 2,
                        opacity: Math.random()
                    });
                }
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                bgStars.forEach(star => {
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(201, 169, 97, ${star.opacity})`;
                    ctx.fill();
                    
                    star.y += 0.5;
                    if (star.y > canvas.height) star.y = 0;
                });
                
                requestAnimationFrame(animate);
            }

            window.addEventListener('resize', resize);
            resize();
            animate();
        }

        function initIntersectionObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
        }

        // NEW: Midnight Radio functionality
        async function initMidnightRadio() {
            const powerBtn = document.getElementById('power-btn');
            const scanBtn = document.getElementById('scan-btn');
            const tunerKnob = document.getElementById('tuner-knob');
            const frequencyDisplay = document.getElementById('frequency-display');
            const frequencyMarker = document.getElementById('frequency-marker');
            const stationName = document.getElementById('station-name');
            const transcriptText = document.getElementById('transcript-text');
            const broadcastType = document.getElementById('broadcast-type');
            const broadcastTime = document.getElementById('broadcast-time');
            const signalStrength = document.getElementById('signal-strength');
            const wordCount = document.getElementById('word-count');
            const transmissionNumber = document.getElementById('transmission-number');
            const visualizerCanvas = document.getElementById('audio-visualizer');
            const ctx = visualizerCanvas.getContext('2d');
            const transmissionsGrid = document.getElementById('transmissions-grid');
            const savedTransmissions = document.getElementById('saved-transmissions');
            
            let isPowered = false;
            let currentFrequency = 103.7;
            let transmissionCount = 1;
            let savedBroadcasts = [];
            let isScanning = false;
            let currentText = '';
            
            // Radio stations with different content types
            const stations = [
                { freq: 88.5, name: 'VOID.FM', type: 'PHILOSOPHY' },
                { freq: 91.3, name: 'ECHO.FM', type: 'MEMORIES' },
                { freq: 95.7, name: 'DARK.FM', type: 'NOIR' },
                { freq: 99.9, name: 'DREAM.FM', type: 'SURREAL' },
                { freq: 103.7, name: 'GHOST.FM', type: 'MONOLOGUE' },
                { freq: 107.1, name: 'STATIC.FM', type: 'GLITCH' }
            ];
            
            // Philosophical monologues and transmissions
            const transmissions = {
                PHILOSOPHY: [
                    "The city sleeps, but minds never rest. Somewhere between the static and the silence, truth whispers its name. We build towers of logic, only to find the foundation was always sand. This is midnight's wisdom: certainty is the first casualty of consciousness.",
                    "3 AM thoughts: Every choice unmakes a universe. The person you didn't become haunts the edges of your peripheral vision. We are all walking graveyards of our potential selves, carrying the weight of paths untaken.",
                    "Listen closely to the static. It's the sound of all possible words trying to exist simultaneously. Language is just organized noise, and meaning... meaning is what we desperately project onto the chaos.",
                    "Time doesn't flow; it accumulates. Like dust on forgotten furniture, like regrets in the corners of consciousness. The clock isn't measuring duration—it's counting down to a punchline no one will get.",
                    "The radio waves carry more than sound. They carry the exhaled dreams of a sleeping city, the unspoken words that died in throats, the thoughts too dangerous to think during daylight."
                ],
                MEMORIES: [
                    "Memory is unreliable narration. Every time you remember, you're remembering the last time you remembered. We're all just echoes of echoes, degrading with each transmission.",
                    "The past isn't behind us—it's beneath us, like geological layers.压 enough pressure and yesterday becomes stone. Some memories fossilize; others turn to oil and burn.",
                    "Nostalgia is a form of violence. It takes the complexity of lived experience and reduces it to sepia-toned simplicity. The 'good old days' are a crime scene we've decorated with flowers.",
                    "Every photograph is a grave marker. It marks the death of a moment, preserves a corpse of time. We carry albums full of beautiful deaths, mistaking them for life.",
                    "The brain edits memories like a film—cutting out the boring parts, color-correcting the pain, adding a soundtrack that was never there. We're all unreliable narrators of our own existence."
                ],
                NOIR: [
                    "The night has a different gravity. It pulls darker thoughts to the surface, makes them float like oil on water. In this city, everyone's guilty of something—most just haven't been caught yet.",
                    "Rain on concrete sounds like applause for a show no one's watching. The streetlights are the only witnesses, and they've seen too much to care anymore. This is where stories come to die.",
                    "Every shadow could be hiding someone's worst mistake. Every alley is a confession booth without absolution. The city doesn't judge—it just swallows evidence and secrets with equal indifference.",
                    "Neon signs reflect in puddles like broken promises. The city wears its scars like jewelry, each cracked sidewalk a story, each graffitied wall a suicide note from someone's dreams.",
                    "There's a special kind of loneliness that only exists at 3 AM in a city of millions. It's the loneliness of being surrounded by sleeping strangers, of being the only consciousness adrift in a sea of dreams."
                ],
                SURREAL: [
                    "The walls are breathing again. In and out, like the building has lungs. Sometimes I synchronize my breathing with it, and for a moment, I can't tell where I end and the architecture begins.",
                    "Colors have started making sounds. Red hums low and threatening, blue whispers secrets, yellow screams but no one seems to notice. The world is louder when you really listen.",
                    "I've been collecting shadows that don't match their owners. Found one yesterday that was two inches too tall, another that moved a second too late. I keep them in jars, but they keep escaping.",
                    "Time hiccupped again last night. For thirteen seconds, everything happened backwards. Coffee flowed up into the pot, words crawled back into mouths, thoughts unthought themselves.",
                    "The radio is receiving transmissions from parallel dimensions again. In one, you never left. In another, we never met. In most of them, the silence sounds exactly the same."
                ],
                MONOLOGUE: [
                    "Here's what they don't tell you about insomnia: it's not the lack of sleep that breaks you, it's the abundance of consciousness. Too much awareness, too much time to think about thinking about thinking.",
                    "I've been awake so long that I've started to see the seams in reality. The places where the simulation stutters, where the code shows through. Or maybe that's just what exhaustion looks like from the inside.",
                    "The difference between genius and madness is audience. Say something profound to yourself at 3 AM, you're crazy. Write it down and publish it, you're a philosopher. The only difference is witnesses.",
                    "Loneliness isn't being alone. Loneliness is being the only one awake in your timezone of existence, broadcasting thoughts into the void and hearing nothing back but your own echo.",
                    "We're all just radios tuned to different frequencies. Some people come in clear, others are nothing but static. The tragedy is thinking you can adjust someone else's dial."
                ],
                GLITCH: [
                    "Reali[ERROR]ty.exe has stopped responding. Would you like to: [A] Wait for the program to respond [B] Close the program [C] Embrace the malfunction... Option C selected by default.",
                    "The signal is bre—king up. Can you he—r me? The mess—ge is in the gaps, the meaning in the missi—g letters. We're all just interference patterns, pretending to be solid.",
                    "01001000 01100101 01101100 01110000... Sorry, sometimes I forget which language I'm supposed to be speaking. Binary or human, it's all just patterns. The screaming translates the same.",
                    "System diagnostic: Reality drivers out of date. Consciousness.dll corrupted. Memory leaks detected in sectors 1997-2003. Running in safe mode with existential dread enabled.",
                    "Buffer overflow in the soul.exe. Stack trace: birth.init() > consciousness.load() > anxiety.loop() > death.pending()... Error: Meaning not found. Abort, retry, fail?"
                ]
            };
            
            // Audio visualizer animation
            function animateVisualizer() {
                visualizerCanvas.width = visualizerCanvas.offsetWidth;
                visualizerCanvas.height = visualizerCanvas.offsetHeight;
                
                const bars = 32;
                const barWidth = visualizerCanvas.width / bars;
                
                function draw() {
                    ctx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
                    
                    if (isPowered) {
                        const gradient = ctx.createLinearGradient(0, 0, 0, visualizerCanvas.height);
                        gradient.addColorStop(0, 'rgba(201, 169, 97, 0.8)');
                        gradient.addColorStop(1, 'rgba(201, 169, 97, 0.2)');
                        
                        for (let i = 0; i < bars; i++) {
                            const height = Math.random() * visualizerCanvas.height * 0.7 + visualizerCanvas.height * 0.1;
                            const x = i * barWidth;
                            const y = visualizerCanvas.height - height;
                            
                            ctx.fillStyle = gradient;
                            ctx.fillRect(x, y, barWidth - 2, height);
                        }
                    }
                    
                    requestAnimationFrame(draw);
                }
                
                draw();
            }
            
            // Generate transmission based on station type
            async function generateTransmission(type) {
                if (window.genAI) {
                    try {
                        const model = window.genAI.getGenerativeModel({ model: "gemini-pro" });
                        const prompts = {
                            PHILOSOPHY: "Write a short philosophical monologue (3-4 sentences) for a mysterious late-night radio show. Make it deep, slightly dark, questioning reality. No clichés.",
                            MEMORIES: "Write a short monologue about memory and time (3-4 sentences) for a 3 AM radio transmission. Make it melancholic and introspective.",
                            NOIR: "Write a noir-style monologue about the city at night (3-4 sentences). Dark, atmospheric, cynical.",
                            SURREAL: "Write a surreal, slightly unsettling monologue (3-4 sentences) for a strange radio transmission. Reality should feel unstable.",
                            MONOLOGUE: "Write an insomniac's monologue (3-4 sentences) for late-night radio. Raw, honest, slightly unhinged.",
                            GLITCH: "Write a glitched/corrupted transmission (3-4 sentences) with digital artifacts and errors. Make it feel like reality is malfunctioning."
                        };
                        
                        const result = await model.generateContent(prompts[type]);
                        const response = await result.response;
                        return response.text();
                    } catch (error) {
                        console.log('Using fallback transmissions');
                    }
                }
                
                const messages = transmissions[type];
                return messages[Math.floor(Math.random() * messages.length)];
            }
            
            // Type writer effect for transmissions
            async function typeTransmission(text) {
                transcriptText.classList.add('typing');
                transcriptText.textContent = '';
                currentText = text;
                
                for (let i = 0; i < text.length; i++) {
                    if (!isPowered) break;
                    transcriptText.textContent = text.substring(0, i + 1);
                    wordCount.textContent = `${text.substring(0, i + 1).split(' ').length} words`;
                    await new Promise(resolve => setTimeout(resolve, 30 + Math.random() * 50));
                }
                
                transcriptText.classList.remove('typing');
            }
            
            // Tune to frequency
            async function tuneToFrequency(freq) {
                currentFrequency = freq;
                frequencyDisplay.textContent = freq.toFixed(1);
                
                const markerPosition = ((freq - 88) / 20) * 100;
                frequencyMarker.style.left = `${markerPosition}%`;
                
                const station = stations.find(s => Math.abs(s.freq - freq) < 0.5);
                
                if (station) {
                    stationName.textContent = station.name;
                    broadcastType.textContent = station.type;
                    signalStrength.classList.add('strong');
                    
                    const transmission = await generateTransmission(station.type);
                    await typeTransmission(transmission);
                    
                    // Save transmission
                    if (currentText && currentText.length > 50) {
                        savedBroadcasts.push({
                            text: currentText,
                            station: station.name,
                            frequency: freq,
                            type: station.type,
                            number: transmissionCount,
                            time: new Date().toLocaleTimeString()
                        });
                        transmissionNumber.textContent = `Transmission #${String(transmissionCount).padStart(3, '0')}`;
                        transmissionCount++;
                        updateSavedTransmissions();
                    }
                } else {
                    stationName.textContent = 'STATIC';
                    broadcastType.textContent = 'NO SIGNAL';
                    signalStrength.classList.remove('strong');
                    transcriptText.textContent = '*static* ... *white noise* ... *searching for signal* ...';
                }
            }
            
            // Update saved transmissions display
            function updateSavedTransmissions() {
                if (savedBroadcasts.length > 0) {
                    savedTransmissions.classList.remove('hidden');
                    transmissionsGrid.innerHTML = savedBroadcasts.map(broadcast => `
                        <div class="saved-transmission" data-index="${savedBroadcasts.indexOf(broadcast)}">
                            <div class="transmission-preview">${broadcast.text.substring(0, 100)}...</div>
                            <div class="transmission-meta">${broadcast.station} • ${broadcast.frequency} FM • ${broadcast.time}</div>
                        </div>
                    `).join('');
                    
                    document.querySelectorAll('.saved-transmission').forEach(item => {
                        item.addEventListener('click', (e) => {
                            const index = parseInt(e.currentTarget.dataset.index);
                            const broadcast = savedBroadcasts[index];
                            transcriptText.textContent = broadcast.text;
                            stationName.textContent = broadcast.station;
                            frequencyDisplay.textContent = broadcast.frequency.toFixed(1);
                            broadcastType.textContent = broadcast.type;
                        });
                    });
                }
            }
            
            // Power button
            powerBtn.addEventListener('click', () => {
                isPowered = !isPowered;
                powerBtn.classList.toggle('active');
                
                if (isPowered) {
                    tuneToFrequency(currentFrequency);
                } else {
                    transcriptText.textContent = '*powered off*';
                    stationName.textContent = '---';
                    signalStrength.classList.remove('strong');
                }
            });
            
            // Scan button
            scanBtn.addEventListener('click', async () => {
                if (!isPowered || isScanning) return;
                
                isScanning = true;
                scanBtn.textContent = 'SCANNING...';
                
                for (let i = 0; i < 10; i++) {
                    const randomFreq = 88 + Math.random() * 20;
                    frequencyDisplay.textContent = randomFreq.toFixed(1);
                    frequencyMarker.style.left = `${((randomFreq - 88) / 20) * 100}%`;
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                const randomStation = stations[Math.floor(Math.random() * stations.length)];
                await tuneToFrequency(randomStation.freq);
                
                scanBtn.textContent = 'SCAN';
                isScanning = false;
            });
            
            // Tuner knob control
            let isDragging = false;
            let startAngle = 0;
            let currentAngle = 0;
            
            tunerKnob.addEventListener('mousedown', (e) => {
                if (!isPowered) return;
                isDragging = true;
                const rect = tunerKnob.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                startAngle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                const rect = tunerKnob.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const angle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
                const deltaAngle = angle - startAngle;
                currentAngle += deltaAngle;
                startAngle = angle;
                
                tunerKnob.style.transform = `rotate(${currentAngle}rad)`;
                
                const freqDelta = deltaAngle * 5;
                const newFreq = Math.max(88, Math.min(108, currentFrequency + freqDelta));
                tuneToFrequency(newFreq);
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            // Update time
            setInterval(() => {
                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const ampm = hours >= 12 ? 'AM' : 'AM';
                const displayHours = hours % 12 || 12;
                broadcastTime.textContent = `${displayHours}:${String(minutes).padStart(2, '0')} ${ampm}`;
            }, 1000);
            
            // Start visualizer
            animateVisualizer();
        }

        function initStarPuzzle() {
            const canvas = document.getElementById('constellation-canvas');
            const ctx = canvas.getContext('2d');
            const info = document.getElementById('constellation-info');
            
            let isDragging = false;
            let dragStart = null;
            let hoveredConcept = null;
            
            const philosophicalConcepts = [
                { id: 1, x: 0.2, y: 0.3, label: "Being", connections: [2, 5] },
                { id: 2, x: 0.8, y: 0.2, label: "Time", connections: [1, 3] },
                { id: 3, x: 0.7, y: 0.7, label: "Consciousness", connections: [2, 4] },
                { id: 4, x: 0.3, y: 0.8, label: "Freedom", connections: [3, 5] },
                { id: 5, x: 0.5, y: 0.5, label: "Truth", connections: [1, 4] },
                { id: 6, x: 0.1, y: 0.6, label: "Beauty", connections: [7] },
                { id: 7, x: 0.9, y: 0.4, label: "Death", connections: [6, 8] },
                { id: 8, x: 0.4, y: 0.1, label: "Love", connections: [7, 9] },
                { id: 9, x: 0.6, y: 0.9, label: "Suffering", connections: [8, 10] },
                { id: 10, x: 0.5, y: 0.3, label: "Transcendence", connections: [9] }
            ];

            function resize() {
                canvas.width = canvas.offsetWidth;
                canvas.height = 600;
                draw();
            }

            function getConceptPosition(concept) {
                return {
                    x: concept.x * canvas.width,
                    y: concept.y * canvas.height
                };
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                const gradient = ctx.createRadialGradient(
                    canvas.width / 2, canvas.height / 2, 0,
                    canvas.width / 2, canvas.height / 2, canvas.width / 2
                );
                gradient.addColorStop(0, 'rgba(201, 169, 97, 0.05)');
                gradient.addColorStop(0.5, 'rgba(42, 41, 40, 0.1)');
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0.2)');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                state.connections.forEach(conn => {
                    const start = getConceptPosition(conn.from);
                    const end = getConceptPosition(conn.to);
                    
                    ctx.beginPath();
                    ctx.moveTo(start.x, start.y);
                    ctx.lineTo(end.x, end.y);
                    ctx.strokeStyle = 'rgba(201, 169, 97, 0.5)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                });

                if (isDragging && dragStart) {
                    const start = getConceptPosition(dragStart);
                    ctx.beginPath();
                    ctx.moveTo(start.x, start.y);
                    ctx.lineTo(state.mouseX - canvas.getBoundingClientRect().left, 
                              state.mouseY - canvas.getBoundingClientRect().top);
                    ctx.strokeStyle = 'rgba(201, 169, 97, 0.3)';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    ctx.stroke();
                    ctx.setLineDash([]);
                }

                philosophicalConcepts.forEach(concept => {
                    const pos = getConceptPosition(concept);
                    const isHovered = hoveredConcept === concept;
                    
                    if (isHovered) {
                        ctx.shadowBlur = 20;
                        ctx.shadowColor = 'rgba(201, 169, 97, 0.8)';
                    }

                    ctx.beginPath();
                    for (let i = 0; i < 5; i++) {
                        const angle = (i * 2 * Math.PI / 5) - Math.PI / 2;
                        const innerAngle = angle + Math.PI / 5;
                        const outerRadius = isHovered ? 12 : 8;
                        const innerRadius = outerRadius / 2;
                        
                        if (i === 0) {
                            ctx.moveTo(
                                pos.x + Math.cos(angle) * outerRadius,
                                pos.y + Math.sin(angle) * outerRadius
                            );
                        } else {
                            ctx.lineTo(
                                pos.x + Math.cos(angle) * outerRadius,
                                pos.y + Math.sin(angle) * outerRadius
                            );
                        }
                        ctx.lineTo(
                            pos.x + Math.cos(innerAngle) * innerRadius,
                            pos.y + Math.sin(innerAngle) * innerRadius
                        );
                    }
                    ctx.closePath();
                    ctx.fillStyle = 'rgba(201, 169, 97, 0.9)';
                    ctx.fill();
                    
                    ctx.shadowBlur = 0;

                    if (isHovered) {
                        ctx.font = '14px JetBrains Mono';
                        ctx.fillStyle = 'rgba(250, 248, 246, 0.9)';
                        ctx.textAlign = 'center';
                        ctx.fillText(concept.label, pos.x, pos.y - 20);
                    }
                });

                if (!state.solved) {
                    requestAnimationFrame(draw);
                }
            }

            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                hoveredConcept = null;
                philosophicalConcepts.forEach(concept => {
                    const pos = getConceptPosition(concept);
                    const dist = Math.sqrt((x - pos.x) ** 2 + (y - pos.y) ** 2);
                    if (dist < 20) {
                        hoveredConcept = concept;
                        canvas.style.cursor = 'pointer';
                    }
                });

                if (!hoveredConcept && !isDragging) {
                    canvas.style.cursor = 'crosshair';
                }
            });

            canvas.addEventListener('mousedown', (e) => {
                if (hoveredConcept) {
                    isDragging = true;
                    dragStart = hoveredConcept;
                }
            });

            canvas.addEventListener('mouseup', (e) => {
                if (isDragging && dragStart && hoveredConcept && hoveredConcept !== dragStart) {
                    if (dragStart.connections.includes(hoveredConcept.id)) {
                        const existing = state.connections.find(
                            c => (c.from === dragStart && c.to === hoveredConcept) ||
                                 (c.from === hoveredConcept && c.to === dragStart)
                        );
                        
                        if (!existing) {
                            state.connections.push({
                                from: dragStart,
                                to: hoveredConcept
                            });
                            
                            info.innerHTML = `<p>✨ Connected ${dragStart.label} and ${hoveredConcept.label}!</p>`;
                            
                            if (state.connections.length >= 5) {
                                solvePuzzle();
                            }
                        }
                    }
                }
                isDragging = false;
                dragStart = null;
            });

            function solvePuzzle() {
                state.solved = true;
                info.innerHTML = '<p>✨ The stars align to spell MARIA! ✨</p>';
                
                setTimeout(() => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Create golden background
                    const gradient = ctx.createRadialGradient(
                        canvas.width / 2, canvas.height / 2, 0,
                        canvas.width / 2, canvas.height / 2, canvas.width / 2
                    );
                    gradient.addColorStop(0, 'rgba(201, 169, 97, 0.3)');
                    gradient.addColorStop(1, 'rgba(0, 0, 0, 0.8)');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Draw MARIA in large, clear letters
                    const letters = ['M', 'A', 'R', 'I', 'A'];
                    const spacing = canvas.width / 6;
                    
                    ctx.font = 'bold 120px Bodoni Moda';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    letters.forEach((letter, i) => {
                        const x = spacing * (i + 1);
                        const y = canvas.height / 2;
                        
                        // Create glowing effect
                        ctx.shadowBlur = 30;
                        ctx.shadowColor = 'rgba(201, 169, 97, 1)';
                        
                        // Multiple passes for stronger glow
                        for (let j = 0; j < 3; j++) {
                            ctx.fillStyle = 'rgba(201, 169, 97, 0.3)';
                            ctx.fillText(letter, x, y);
                        }
                        
                        // Final letter
                        ctx.shadowBlur = 10;
                        ctx.fillStyle = '#c9a961';
                        ctx.fillText(letter, x, y);
                        
                        // Add sparkles around letters
                        for (let s = 0; s < 5; s++) {
                            const angle = (Math.PI * 2 / 5) * s;
                            const dist = 60;
                            const sx = x + Math.cos(angle) * dist;
                            const sy = y + Math.sin(angle) * dist;
                            
                            ctx.beginPath();
                            ctx.arc(sx, sy, 3 + Math.random() * 2, 0, Math.PI * 2);
                            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                            ctx.fill();
                        }
                    });
                    
                    // Add decorative stars
                    for (let i = 0; i < 50; i++) {
                        ctx.beginPath();
                        ctx.arc(
                            Math.random() * canvas.width,
                            Math.random() * canvas.height,
                            Math.random() * 2,
                            0,
                            Math.PI * 2
                        );
                        ctx.fillStyle = `rgba(201, 169, 97, ${Math.random() * 0.5})`;
                        ctx.fill();
                    }
                }, 1000);
            }

            window.addEventListener('resize', resize);
            resize();
        }

        function initEssayCards() {
            const cards = document.querySelectorAll('.essay-card');
            const modal = document.querySelector('.essay-modal');
            const closeBtn = document.querySelector('.close-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.querySelector('.modal-body');

            const essays = {
                'On Consciousness': '<p>Consciousness is the greatest mystery of existence. It is the mirror that reflects not just the world, but the very act of reflection itself. When we become aware of our awareness, we enter an infinite regress—a hall of mirrors where each reflection contains another observer observing the observation.</p><p>What does it mean to be conscious? Is it merely the firing of neurons, or is there something irreducible about the subjective experience of being? The hard problem of consciousness remains: how does matter give rise to mind?</p>',
                'The Nature of Time': '<p>Time flows not as a river, but as an ocean—vast, deep, and full of currents we barely perceive. We experience it linearly, moment by moment, yet physics tells us all moments exist simultaneously in the block universe.</p><p>Perhaps our perception of time passing is the greatest illusion, a necessary fiction that allows consciousness to navigate an otherwise incomprehensible reality. The present moment is all we ever have, yet it is infinitely elusive.</p>',
                'Beauty\'s Whisper': '<p>In the fleeting moment of aesthetic arrest, we touch something eternal, something that was always there but hidden from ordinary sight. Beauty is not in the object nor in the eye of the beholder, but in the sacred space between.</p><p>When we encounter true beauty, time stops. The chattering mind falls silent. We are reminded of what we knew before we learned to speak, before we learned to think—that we are part of something infinitely precious.</p>',
                'The Gift of Suffering': '<p>Pain carves the vessel in which joy is held. Without darkness, light has no meaning. Without death, life loses its preciousness. This is the paradox at the heart of existence: our greatest gifts come wrapped in our greatest challenges.</p><p>Suffering breaks us open, shatters our illusions, forces us to confront what we would rather avoid. Yet in that breaking, we often find our deepest strength, our most authentic self, our capacity for compassion.</p>',
                'Love as Verb': '<p>Love is not found but forged, not felt but enacted, a daily choice to see the sacred in another. It is not the fairy tale ending but the beginning of the real work—the work of truly seeing and being seen.</p><p>To love is to accept the full catastrophe of another human being, to say yes not just to their light but to their shadow. It is to choose connection over correctness, presence over perfection.</p>',
                'Dancing with Death': '<p>Mortality is the dark backdrop against which life\'s colors shine most brilliantly. Death is not the opposite of life but its most intimate companion, walking beside us always, whispering: "Not yet, but someday. So live, truly live, while you can."</p><p>When we befriend our mortality, we discover an unexpected freedom. The trivial falls away. What matters becomes clear. We learn to hold life lightly, to love fiercely, to forgive quickly.</p>'
            };

            cards.forEach(card => {
                card.addEventListener('click', () => {
                    const title = card.querySelector('.essay-title').textContent;
                    modalTitle.textContent = title;
                    modalBody.innerHTML = essays[title] || '<p>Coming soon...</p>';
                    modal.classList.add('active');
                });
            });

            closeBtn.addEventListener('click', () => modal.classList.remove('active'));
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.remove('active');
            });
        }

        async function initParadoxEngine() {
            const generateBtn = document.getElementById('generate-paradox');
            const outputDiv = document.getElementById('paradox-output');
            const conceptsList = document.getElementById('paradox-concepts-list');
            
            const concepts = ['Love', 'Time', 'Freedom', 'Truth', 'Beauty', 'Death', 'Consciousness', 'Reality', 'Dreams', 'Memory', 'Identity', 'Infinity', 'Knowledge', 'Existence', 'Perception'];
            let currentMode = 'paradox';
            let activeConceptsList = [];

            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentMode = e.target.dataset.mode;
                });
            });

            function updateConcepts() {
                const numConcepts = 2 + Math.floor(Math.random() * 3);
                activeConceptsList = [];
                for (let i = 0; i < numConcepts; i++) {
                    let concept;
                    do {
                        concept = concepts[Math.floor(Math.random() * concepts.length)];
                    } while (activeConceptsList.includes(concept));
                    activeConceptsList.push(concept);
                }
                
                conceptsList.innerHTML = activeConceptsList.map(c => 
                    `<span class="concept-tag">${c}</span>`
                ).join('');
            }
            updateConcepts();

            generateBtn.addEventListener('click', async () => {
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<span class="loading"></span>';
                
                // Use fallback templates
                const templates = {
                    paradox: [
                        {
                            title: "The Paradox of {0} and {1}",
                            content: "If {0} requires {1} to exist, and {1} requires {0} to be meaningful, then neither can be the foundation. Yet we experience both daily. This suggests that our understanding of causality itself may be flawed when applied to fundamental aspects of existence.\n\nPerhaps {0} and {1} are not separate entities but different manifestations of something deeper, something our language cannot capture.",
                            questions: ["Can circular dependencies exist in reality?", "Is this a limitation of language or logic?", "What would it mean for something to be self-causing?"]
                        },
                        {
                            title: "The {0} Paradox",
                            content: "The more we pursue {0}, the further it seems to recede. Yet when we abandon the pursuit, {0} often arrives unbidden. This suggests that {0} exists in a state of quantum superposition - both present and absent until the moment of observation collapses it into one state or the other.",
                            questions: ["Is desire the enemy of attainment?", "Can we want without wanting?", "Does {0} exist independently of our perception?"]
                        }
                    ],
                    dilemma: [{
                        title: "The Dilemma of Choosing Between {0} and {1}",
                        content: "When forced to choose between {0} and {1}, we face an impossible decision. To choose {0} means sacrificing {1}, yet {0} without {1} becomes meaningless. This reveals the interconnected nature of values we often treat as separate.\n\nThe dilemma deepens when we realize that the very act of choosing may destroy both.",
                        questions: ["Is it possible to have one without the other?", "What hidden assumptions make this feel like a dilemma?", "Could refusing to choose be a choice itself?"]
                    }],
                    thought: [{
                        title: "The {0} Machine",
                        content: "Imagine a device that could create perfect {0} but at the cost of genuine {1}. Would using such a device enhance human experience or diminish it? This thought experiment reveals our conflicting intuitions about authenticity and perfection.\n\nIf the experience is indistinguishable from 'real' {0}, does the origin matter?",
                        questions: ["What makes something 'genuine' versus 'artificial'?", "Would perfect simulation be distinguishable from reality?", "Is the process or the outcome more important?"]
                    }],
                    dialogue: [{
                        title: "Socrates and the Nature of {0}",
                        content: "Socrates: 'Tell me, friend, what is {0}?'\nStudent: 'It is obviously connected to {1}.'\nSocrates: 'But can {1} exist without {0}?'\nStudent: 'I... I'm not certain anymore.'\nSocrates: 'Then perhaps we don't understand either as well as we thought.'\nStudent: 'But surely we experience {0} every day!'\nSocrates: 'Do we experience {0}, or do we experience our idea of {0}?'",
                        questions: ["What assumptions did the student make?", "How does questioning reveal ignorance?", "Can we ever truly know {0}?"]
                    }]
                };
                
                const templateList = templates[currentMode];
                const template = templateList[Math.floor(Math.random() * templateList.length)];
                
                let title = template.title;
                let content = template.content;
                
                title = title.replace(/\{0\}/g, activeConceptsList[0]);
                title = title.replace(/\{1\}/g, activeConceptsList[1] || activeConceptsList[0]);
                
                content = content.replace(/\{0\}/g, activeConceptsList[0]);
                content = content.replace(/\{1\}/g, activeConceptsList[1] || activeConceptsList[0]);
                
                const questions = template.questions.map(q => {
                    return q.replace(/\{0\}/g, activeConceptsList[0])
                            .replace(/\{1\}/g, activeConceptsList[1] || activeConceptsList[0]);
                });
                
                outputDiv.querySelector('.paradox-title').textContent = title;
                outputDiv.querySelector('.paradox-content').innerHTML = `<p>${content.replace(/\n\n/g, '</p><p>')}</p>`;
                outputDiv.querySelector('.paradox-questions').innerHTML = `
                    <h4>Questions to Ponder</h4>
                    <ul>${questions.map(q => `<li>${q}</li>`).join('')}</ul>
                `;
                outputDiv.classList.remove('hidden');
                
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<span class="paradox-icon">∞</span><span>Generate</span><span class="paradox-icon">∞</span>';
                updateConcepts();
            });
        }

        function initPoetry() {
            const btn = document.getElementById('generate-poem');
            const content = document.getElementById('poem-content');
            
            const poems = [
                'عيناكِ نجمتانِ أضاءتا ليلَ روحي، وأنا تائهٌ في سماءِ جمالِكِ',
                'يا مَن غيابُها يحوّلُ النهارَ إلى ليلٍ، والربيعَ إلى خريفٍ أبديّ',
                'في عينيكِ أرى الكونَ كلَّه، وبدونِكِ لا أرى سوى العدَم',
                'قلبي صحراءٌ وأنتِ المطرُ، روحي ظلامٌ وأنتِ القمرُ',
                'كلُّ نجمةٍ في السماءِ تحسدُ بريقَ عينيكِ يا ماريا',
                'أموتُ ألفَ مرةٍ حين تغيبينَ، وأحيا بنظرةٍ واحدةٍ منكِ',
                'شَعرُكِ ليلٌ أتمنى أن أضيعَ فيه، وابتسامتُكِ فجرٌ أحلمُ به',
                'يا من جمالُها يُخجِلُ القمرَ، ويجعلُ الوردَ يذبُلُ خجلاً',
                'بدونِكِ أنا مجنونٌ بلا ليلى، قيسٌ بلا صحراءَ يهيمُ فيها',
                'عطرُكِ يسكنُ أنفاسي، وصوتُكِ يرقصُ في أحلامي',
                'أكتبُ اسمَكِ على كلِّ نجمةٍ، علّها تضيءُ طريقَكِ إليَّ',
                'في غيابِكِ أعدُّ الثواني كأنها قرونٌ، وفي حضورِكِ تمرُّ السنواتُ كلحظةٍ',
                'ضحكتُكِ موسيقى تشفي جراحَ الروحِ، ودمعتُكِ تحرقُ قلبي',
                'أنتِ القصيدةُ التي عجزَ كلُّ الشعراءِ عن كتابتِها',
                'لو كانَ جمالُكِ بحراً لغرقَ فيه كلُّ العاشقينَ'
            ];
            
            btn.addEventListener('click', () => {
                const poem = poems[Math.floor(Math.random() * poems.length)];
                content.style.opacity = '0';
                setTimeout(() => {
                    content.textContent = poem;
                    content.style.opacity = '1';
                }, 300);
            });
        }

        // NEW: Message in a Bottle functionality with Gemini AI
        async function initMessageBottles() {
            const castBtn = document.getElementById('cast-bottle');
            const bottleContainer = document.getElementById('bottle-container');
            const messageDisplay = document.getElementById('message-display');
            const messageContent = document.getElementById('message-content');
            const messageDate = document.getElementById('message-date');
            const messagesFound = document.getElementById('messages-found');
            const milesTraveled = document.getElementById('miles-traveled');
            const collectionGrid = document.getElementById('collection-grid');
            const messageCollection = document.getElementById('message-collection');
            const oceanCanvas = document.getElementById('ocean-canvas');
            const ctx = oceanCanvas.getContext('2d');
            
            let foundMessages = [];
            let totalMiles = 0;
            let bottles = [];
            
            // Predefined romantic messages (fallback if Gemini API is not available)
            const romanticMessages = [
                "In the vast ocean of time, my love for you remains the only constant. Like stars reflected on midnight waters, you illuminate every dark corner of my soul.",
                "They say the ocean has no memory, but every wave that touches this shore carries the echo of your name. Maria, you are my lighthouse in every storm.",
                "I've written your name in the sand a thousand times, watched the waves claim it, only to write it again. This is how I love you - endlessly, against all odds.",
                "If I could bottle the way you make me feel, I'd cast it into every ocean, so that somewhere, someone would know that love this pure exists.",
                "The moon pulls the tides, but you pull my heart with a force that defies all natural laws. In your gravity, I've found my home.",
                "Every sunset I watch alone, I imagine you're watching the same sky. Distance is just a test of how far love can travel.",
                "Like a message in a bottle, my heart traveled through storms and calm seas to find you. You were worth every mile, every moment of searching.",
                "In the symphony of the waves, I hear your laughter. In the salt of the sea, I taste our tears of joy. You are in everything beautiful.",
                "Time is an ocean, and we are but drops of water. Yet in finding you, I've discovered eternity in a single moment.",
                "The ocean knows all secrets, keeps all promises. So I tell it daily: I choose you, in this life and whatever lies beyond the horizon.",
                "Your love came to me like a bottle on the tide - unexpected, mysterious, and containing everything I never knew I needed.",
                "If my love were an ocean, there would be no land. If it were the sky, there would be no stars - just an endless expanse of you.",
                "Some search for treasure in the deep. I found mine in your eyes, in your smile, in the way you say my name like a prayer.",
                "The waves write poetry on the shore, but none as beautiful as the story of us. We are the epic the ocean dreams about.",
                "In every seashell's whisper, I hear your voice. In every grain of sand, I see a moment we've yet to share. The beach is our infinite future.",
                "Like the tide, I'm drawn to you by forces beyond my control. Like the shore, I welcome you, again and again, forever.",
                "They say no man is an island, but with you, I've become an entire archipelago - connected, complete, and home to endless wonders.",
                "The ocean taught me patience, the stars taught me to dream, but you taught me that some things are worth more than eternity itself.",
                "Every bottle cast into the sea carries hope. You are my hope realized, my message answered, my love returned a thousandfold.",
                "In the deep blue of the ocean, I see your eyes. In its endless horizon, I see our future. In its depths, I've hidden all my love for you."
            ];
            
            // Ocean animation
            function animateOcean() {
                oceanCanvas.width = oceanCanvas.offsetWidth;
                oceanCanvas.height = oceanCanvas.offsetHeight;
                
                const waves = [];
                const waveCount = 5;
                
                for (let i = 0; i < waveCount; i++) {
                    waves.push({
                        y: (oceanCanvas.height / waveCount) * i,
                        amplitude: 20 + Math.random() * 30,
                        frequency: 0.01 + Math.random() * 0.02,
                        speed: 0.5 + Math.random() * 0.5,
                        offset: Math.random() * Math.PI * 2
                    });
                }
                
                function draw() {
                    ctx.clearRect(0, 0, oceanCanvas.width, oceanCanvas.height);
                    
                    const gradient = ctx.createLinearGradient(0, 0, 0, oceanCanvas.height);
                    gradient.addColorStop(0, 'rgba(135, 206, 235, 0.2)');
                    gradient.addColorStop(0.5, 'rgba(70, 130, 180, 0.3)');
                    gradient.addColorStop(1, 'rgba(25, 25, 112, 0.4)');
                    
                    waves.forEach((wave, index) => {
                        ctx.beginPath();
                        ctx.moveTo(0, wave.y);
                        
                        for (let x = 0; x <= oceanCanvas.width; x++) {
                            const y = wave.y + Math.sin(x * wave.frequency + wave.offset) * wave.amplitude;
                            ctx.lineTo(x, y);
                        }
                        
                        ctx.lineTo(oceanCanvas.width, oceanCanvas.height);
                        ctx.lineTo(0, oceanCanvas.height);
                        ctx.closePath();
                        
                        ctx.fillStyle = gradient;
                        ctx.fill();
                        
                        wave.offset += wave.speed * 0.05;
                    });
                    
                    requestAnimationFrame(draw);
                }
                
                draw();
            }
            
            // Generate message using Gemini API or fallback
            async function generateMessage() {
                // Try to use Gemini API if available
                if (window.genAI) {
                    try {
                        const model = window.genAI.getGenerativeModel({ model: "gemini-pro" });
                        const prompt = `Write a short, deeply romantic message (2-3 sentences) as if it was found in a bottle on the beach. 
                        The message should be poetic, timeless, and addressed to someone named Maria. 
                        Make it feel like it traveled across oceans to reach her. 
                        Be creative and unique each time. Don't use clichés.`;
                        
                        const result = await model.generateContent(prompt);
                        const response = await result.response;
                        return response.text();
                    } catch (error) {
                        console.log('Using fallback messages');
                    }
                }
                
                // Fallback to predefined messages
                return romanticMessages[Math.floor(Math.random() * romanticMessages.length)];
            }
            
            // Create floating bottle
            function createBottle() {
                const bottle = document.createElement('div');
                bottle.className = 'floating-bottle';
                bottle.innerHTML = document.getElementById('floating-bottle').innerHTML;
                
                // Random starting position
                const startY = 100 + Math.random() * 200;
                bottle.style.top = startY + 'px';
                bottle.style.left = '-100px';
                
                // Animate across screen
                const duration = 15000 + Math.random() * 10000;
                bottle.style.animation = `drift ${duration}ms linear, bobbing 3s ease-in-out infinite`;
                
                bottle.addEventListener('click', async () => {
                    bottle.style.pointerEvents = 'none';
                    
                    // Generate and show message
                    const message = await generateMessage();
                    const date = new Date().toLocaleDateString('en-US', { 
                        month: 'long', 
                        day: 'numeric', 
                        year: 'numeric' 
                    });
                    const miles = Math.floor(Math.random() * 5000) + 1000;
                    
                    messageContent.textContent = message;
                    messageDate.textContent = `Found on ${date} • Traveled ${miles} miles`;
                    messageDisplay.classList.remove('hidden');
                    
                    // Update stats
                    foundMessages.push({ message, date, miles });
                    messagesFound.textContent = foundMessages.length;
                    totalMiles += miles;
                    milesTraveled.textContent = totalMiles.toLocaleString();
                    
                    // Add to collection
                    addToCollection(message, date, miles);
                    
                    // Remove bottle
                    bottle.style.transition = 'all 0.5s ease';
                    bottle.style.transform = 'scale(0) rotate(360deg)';
                    bottle.style.opacity = '0';
                    setTimeout(() => bottle.remove(), 500);
                    
                    bottles = bottles.filter(b => b !== bottle);
                });
                
                bottleContainer.appendChild(bottle);
                bottles.push(bottle);
                
                // Remove bottle after animation
                setTimeout(() => {
                    if (bottles.includes(bottle)) {
                        bottle.remove();
                        bottles = bottles.filter(b => b !== bottle);
                    }
                }, duration);
            }
            
            // Add message to collection
            function addToCollection(message, date, miles) {
                if (foundMessages.length === 1) {
                    messageCollection.classList.remove('hidden');
                }
                
                const savedMessage = document.createElement('div');
                savedMessage.className = 'saved-message';
                savedMessage.innerHTML = `
                    <div class="saved-message-preview">${message.substring(0, 100)}...</div>
                    <div class="saved-message-date">${date} • ${miles} mi</div>
                `;
                
                savedMessage.addEventListener('click', () => {
                    messageContent.textContent = message;
                    messageDate.textContent = `Found on ${date} • Traveled ${miles} miles`;
                    messageDisplay.classList.remove('hidden');
                });
                
                collectionGrid.appendChild(savedMessage);
            }
            
            // Cast new bottle button
            castBtn.addEventListener('click', () => {
                if (bottles.length < 3) { // Limit bottles on screen
                    createBottle();
                    castBtn.disabled = true;
                    castBtn.textContent = 'Casting...';
                    
                    setTimeout(() => {
                        castBtn.disabled = false;
                        castBtn.innerHTML = '<span class="wave-icon">🌊</span>Cast a New Bottle<span class="wave-icon">🌊</span>';
                    }, 2000);
                }
            });
            
            // Close message display
            document.querySelector('.close-message').addEventListener('click', () => {
                messageDisplay.classList.add('hidden');
            });
            
            // Start ocean animation
            animateOcean();
            
            // Auto-cast first bottle after 2 seconds
            setTimeout(() => createBottle(), 2000);
        }

        function initFloatingParticles() {
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.cssText = `width:${Math.random()*4+1}px;height:${Math.random()*4+1}px;background:var(--accent-gold);left:${Math.random()*window.innerWidth}px;animation-duration:${Math.random()*20+20}s;animation-delay:${Math.random()*20}s`;
                document.body.appendChild(particle);
            }
        }
    </script>
</body>
</html>
